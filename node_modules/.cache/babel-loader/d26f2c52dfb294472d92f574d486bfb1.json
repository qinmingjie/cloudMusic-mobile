{"ast":null,"code":"import { parse, stringify } from 'qs';\nimport 'isomorphic-fetch';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar defineProperty = _defineProperty;\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nvar objectSpread = _objectSpread;\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nvar arrayWithoutHoles = _arrayWithoutHoles;\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nvar iterableToArray = _iterableToArray;\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar nonIterableSpread = _nonIterableSpread;\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}\n\nvar toConsumableArray = _toConsumableArray;\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar classCallCheck = _classCallCheck;\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar createClass = _createClass;\n\nfunction createCommonjsModule(fn, module) {\n  return module = {\n    exports: {}\n  }, fn(module, module.exports), module.exports;\n}\n\nvar _typeof_1 = createCommonjsModule(function (module) {\n  function _typeof2(obj) {\n    if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n      _typeof2 = function _typeof2(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof2 = function _typeof2(obj) {\n        return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n      };\n    }\n\n    return _typeof2(obj);\n  }\n\n  function _typeof(obj) {\n    if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n      module.exports = _typeof = function _typeof(obj) {\n        return _typeof2(obj);\n      };\n    } else {\n      module.exports = _typeof = function _typeof(obj) {\n        return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  module.exports = _typeof;\n}); // 返回一个组合了所有插件的“插件”\n\n\nfunction compose(middlewares) {\n  if (!Array.isArray(middlewares)) throw new TypeError('Middlewares must be an array!');\n  var middlewaresLen = middlewares.length;\n\n  for (var i = 0; i < middlewaresLen; i++) {\n    if (typeof middlewares[i] !== 'function') {\n      throw new TypeError('Middleware must be componsed of function');\n    }\n  }\n\n  return function wrapMiddlewares(params, next) {\n    var index = -1;\n\n    function dispatch(i) {\n      if (i <= index) {\n        return Promise.reject(new Error('next() should not be called multiple times in one middleware!'));\n      }\n\n      index = i;\n      var fn = middlewares[i] || next;\n      if (!fn) return Promise.resolve();\n\n      try {\n        return Promise.resolve(fn(params, function () {\n          return dispatch(i + 1);\n        }));\n      } catch (err) {\n        return Promise.reject(err);\n      }\n    }\n\n    return dispatch(0);\n  };\n}\n\nvar Onion = /*#__PURE__*/function () {\n  function Onion(defaultMiddlewares) {\n    classCallCheck(this, Onion);\n    if (!Array.isArray(defaultMiddlewares)) throw new TypeError('Default middlewares must be an array!');\n    this.defaultMiddlewares = toConsumableArray(defaultMiddlewares);\n    this.middlewares = [];\n  }\n\n  createClass(Onion, [{\n    key: \"use\",\n    // 内置内核中间件长度\n    value: function use(newMiddleware) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        global: false,\n        core: false,\n        defaultInstance: false\n      };\n      var core = false;\n      var global = false;\n      var defaultInstance = false;\n\n      if (typeof opts === 'number') {\n        if (process && process.env && process.env.NODE_ENV === 'development') {\n          console.warn('use() options should be object, number property would be deprecated in future，please update use() options to \"{ core: true }\".');\n        }\n\n        core = true;\n        global = false;\n      } else if (_typeof_1(opts) === 'object' && opts) {\n        global = opts.global || false;\n        core = opts.core || false;\n        defaultInstance = opts.defaultInstance || false;\n      } // 全局中间件\n\n\n      if (global) {\n        Onion.globalMiddlewares.splice(Onion.globalMiddlewares.length - Onion.defaultGlobalMiddlewaresLength, 0, newMiddleware);\n        return;\n      } // 内核中间件\n\n\n      if (core) {\n        Onion.coreMiddlewares.splice(Onion.coreMiddlewares.length - Onion.defaultCoreMiddlewaresLength, 0, newMiddleware);\n        return;\n      } // 默认实例中间件，供开发者使用\n\n\n      if (defaultInstance) {\n        this.defaultMiddlewares.push(newMiddleware);\n        return;\n      } // 实例中间件\n\n\n      this.middlewares.push(newMiddleware);\n    }\n  }, {\n    key: \"execute\",\n    value: function execute() {\n      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var fn = compose([].concat(toConsumableArray(this.middlewares), toConsumableArray(this.defaultMiddlewares), toConsumableArray(Onion.globalMiddlewares), toConsumableArray(Onion.coreMiddlewares)));\n      return fn(params);\n    }\n  }]);\n  return Onion;\n}();\n\nOnion.globalMiddlewares = [];\nOnion.defaultGlobalMiddlewaresLength = 0;\nOnion.coreMiddlewares = [];\nOnion.defaultCoreMiddlewaresLength = 0;\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nvar assertThisInitialized = _assertThisInitialized;\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof_1(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nvar possibleConstructorReturn = _possibleConstructorReturn;\nvar getPrototypeOf = createCommonjsModule(function (module) {\n  function _getPrototypeOf(o) {\n    module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n      return o.__proto__ || Object.getPrototypeOf(o);\n    };\n    return _getPrototypeOf(o);\n  }\n\n  module.exports = _getPrototypeOf;\n});\nvar setPrototypeOf = createCommonjsModule(function (module) {\n  function _setPrototypeOf(o, p) {\n    module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  module.exports = _setPrototypeOf;\n});\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nvar inherits = _inherits;\n\nfunction _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nvar isNativeFunction = _isNativeFunction;\nvar construct = createCommonjsModule(function (module) {\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === \"function\") return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      module.exports = _construct = Reflect.construct;\n    } else {\n      module.exports = _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  module.exports = _construct;\n});\nvar wrapNativeSuper = createCommonjsModule(function (module) {\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n    module.exports = _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== \"function\") {\n        throw new TypeError(\"Super expression must either be null or a function\");\n      }\n\n      if (typeof _cache !== \"undefined\") {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return construct(Class, arguments, getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  module.exports = _wrapNativeSuper;\n});\n\nvar MapCache = /*#__PURE__*/function () {\n  function MapCache(options) {\n    classCallCheck(this, MapCache);\n    this.cache = new Map();\n    this.timer = {};\n    this.extendOptions(options);\n  }\n\n  createClass(MapCache, [{\n    key: \"extendOptions\",\n    value: function extendOptions(options) {\n      this.maxCache = options.maxCache || 0;\n    }\n  }, {\n    key: \"get\",\n    value: function get(key) {\n      return this.cache.get(JSON.stringify(key));\n    }\n  }, {\n    key: \"set\",\n    value: function set(key, value) {\n      var _this = this;\n\n      var ttl = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 60000; // 如果超过最大缓存数, 删除头部的第一个缓存.\n\n      if (this.maxCache > 0 && this.cache.size >= this.maxCache) {\n        var deleteKey = toConsumableArray(this.cache.keys())[0];\n        this.cache.delete(deleteKey);\n\n        if (this.timer[deleteKey]) {\n          clearTimeout(this.timer[deleteKey]);\n        }\n      }\n\n      var cacheKey = JSON.stringify(key);\n      this.cache.set(cacheKey, value);\n\n      if (ttl > 0) {\n        this.timer[cacheKey] = setTimeout(function () {\n          _this.cache.delete(cacheKey);\n\n          delete _this.timer[cacheKey];\n        }, ttl);\n      }\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(key) {\n      var cacheKey = JSON.stringify(key);\n      delete this.timer[cacheKey];\n      return this.cache.delete(cacheKey);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.timer = {};\n      return this.cache.clear();\n    }\n  }]);\n  return MapCache;\n}();\n/**\n * 请求异常\n */\n\n\nvar RequestError = /*#__PURE__*/function (_Error) {\n  inherits(RequestError, _Error);\n\n  function RequestError(text, request) {\n    var _this2;\n\n    var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'RequestError';\n    classCallCheck(this, RequestError);\n    _this2 = possibleConstructorReturn(this, getPrototypeOf(RequestError).call(this, text));\n    _this2.name = 'RequestError';\n    _this2.request = request;\n    _this2.type = type;\n    return _this2;\n  }\n\n  return RequestError;\n}(wrapNativeSuper(Error));\n/**\n * 响应异常\n */\n\n\nvar ResponseError = /*#__PURE__*/function (_Error2) {\n  inherits(ResponseError, _Error2);\n\n  function ResponseError(response, text, data, request) {\n    var _this3;\n\n    var type = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'ResponseError';\n    classCallCheck(this, ResponseError);\n    _this3 = possibleConstructorReturn(this, getPrototypeOf(ResponseError).call(this, text || response.statusText));\n    _this3.name = 'ResponseError';\n    _this3.data = data;\n    _this3.response = response;\n    _this3.request = request;\n    _this3.type = type;\n    return _this3;\n  }\n\n  return ResponseError;\n}(wrapNativeSuper(Error));\n/**\n * http://gitlab.alipay-inc.com/KBSJ/gxt/blob/release_gxt_S8928905_20180531/src/util/request.js#L63\n * 支持gbk\n */\n\n\nfunction readerGBK(file) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n\n    reader.onload = function () {\n      resolve(reader.result);\n    };\n\n    reader.onerror = reject;\n    reader.readAsText(file, 'GBK'); // setup GBK decoding\n  });\n}\n/**\n * 安全的JSON.parse\n */\n\n\nfunction safeJsonParse(data) {\n  var throwErrIfParseFail = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var response = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var request = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  try {\n    return JSON.parse(data);\n  } catch (e) {\n    if (throwErrIfParseFail) {\n      throw new ResponseError(response, 'JSON.parse fail', data, request, 'ParseError');\n    }\n  } // eslint-disable-line no-empty\n\n\n  return data;\n}\n\nfunction timeout2Throw(msec, request) {\n  return new Promise(function (_, reject) {\n    setTimeout(function () {\n      reject(new RequestError(\"timeout of \".concat(msec, \"ms exceeded\"), request, 'Timeout'));\n    }, msec);\n  });\n} // If request options contain 'cancelToken', reject request when token has been canceled\n\n\nfunction cancel2Throw(opt) {\n  return new Promise(function (_, reject) {\n    if (opt.cancelToken) {\n      opt.cancelToken.promise.then(function (cancel) {\n        reject(cancel);\n      });\n    }\n  });\n}\n\nvar toString = Object.prototype.toString; // Check env is browser or node\n\nfunction getEnv() {\n  var env; // Only Node.JS has a process variable that is of [[Class]] process\n\n  if (typeof process !== 'undefined' && toString.call(process) === '[object process]') {\n    // For node use HTTP adapter\n    env = 'NODE';\n  }\n\n  if (typeof XMLHttpRequest !== 'undefined') {\n    env = 'BROWSER';\n  }\n\n  return env;\n}\n\nfunction isArray(val) {\n  return _typeof_1(val) === 'object' && Object.prototype.toString.call(val) === '[object Array]';\n}\n\nfunction isURLSearchParams(val) {\n  return typeof URLSearchParams !== 'undefined' && val instanceof URLSearchParams;\n}\n\nfunction isDate(val) {\n  return _typeof_1(val) === 'object' && Object.prototype.toString.call(val) === '[object Date]';\n}\n\nfunction isObject(val) {\n  return val !== null && _typeof_1(val) === 'object';\n}\n\nfunction forEach2ObjArr(target, callback) {\n  if (!target) return;\n\n  if (_typeof_1(target) !== 'object') {\n    target = [target];\n  }\n\n  if (isArray(target)) {\n    for (var i = 0; i < target.length; i++) {\n      callback.call(null, target[i], i, target);\n    }\n  } else {\n    for (var key in target) {\n      if (Object.prototype.hasOwnProperty.call(target, key)) {\n        callback.call(null, target[key], key, target);\n      }\n    }\n  }\n}\n\nfunction getParamObject(val) {\n  if (isURLSearchParams(val)) {\n    return parse(val.toString(), {\n      strictNullHandling: true\n    });\n  }\n\n  if (typeof val === 'string') {\n    return [val];\n  }\n\n  return val;\n}\n\nfunction reqStringify(val) {\n  return stringify(val, {\n    arrayFormat: 'repeat',\n    strictNullHandling: true\n  });\n}\n\nfunction mergeRequestOptions(options, options2Merge) {\n  return objectSpread({}, options, options2Merge, {\n    headers: objectSpread({}, options.headers, options2Merge.headers),\n    params: objectSpread({}, getParamObject(options.params), getParamObject(options2Merge.params)),\n    method: (options2Merge.method || options.method || 'get').toLowerCase()\n  });\n} // 前后缀拦截\n\n\nvar addfix = function addfix(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var prefix = options.prefix,\n      suffix = options.suffix;\n\n  if (prefix) {\n    url = \"\".concat(prefix).concat(url);\n  }\n\n  if (suffix) {\n    url = \"\".concat(url).concat(suffix);\n  }\n\n  return {\n    url: url,\n    options: options\n  };\n};\n\nvar warnedCoreType = false; // 默认缓存判断，开放缓存判断给非 get 请求使用\n\nfunction __defaultValidateCache(url, options) {\n  var _options$method = options.method,\n      method = _options$method === void 0 ? 'get' : _options$method;\n  return method.toLowerCase() === 'get';\n}\n\nfunction fetchMiddleware(ctx, next) {\n  if (!ctx) return next();\n  var _ctx$req = ctx.req;\n  _ctx$req = _ctx$req === void 0 ? {} : _ctx$req;\n  var _ctx$req$options = _ctx$req.options,\n      options = _ctx$req$options === void 0 ? {} : _ctx$req$options,\n      _ctx$req$url = _ctx$req.url,\n      url = _ctx$req$url === void 0 ? '' : _ctx$req$url,\n      cache = ctx.cache,\n      responseInterceptors = ctx.responseInterceptors;\n\n  var _options$timeout = options.timeout,\n      timeout = _options$timeout === void 0 ? 0 : _options$timeout,\n      _options$__umiRequest = options.__umiRequestCoreType__,\n      __umiRequestCoreType__ = _options$__umiRequest === void 0 ? 'normal' : _options$__umiRequest,\n      _options$useCache = options.useCache,\n      useCache = _options$useCache === void 0 ? false : _options$useCache,\n      _options$method2 = options.method,\n      method = _options$method2 === void 0 ? 'get' : _options$method2,\n      params = options.params,\n      ttl = options.ttl,\n      _options$validateCach = options.validateCache,\n      validateCache = _options$validateCach === void 0 ? __defaultValidateCache : _options$validateCach;\n\n  if (__umiRequestCoreType__ !== 'normal') {\n    if (process && process.env && process.env.NODE_ENV === 'development' && warnedCoreType === false) {\n      warnedCoreType = true;\n      console.warn('__umiRequestCoreType__ is a internal property that use in umi-request, change its value would affect the behavior of request! It only use when you want to extend or use request core.');\n    }\n\n    return next();\n  }\n\n  var adapter = fetch;\n\n  if (!adapter) {\n    throw new Error('Global fetch not exist!');\n  } // 从缓存池检查是否有缓存数据\n\n\n  var isBrowser = getEnv() === 'BROWSER';\n  var needCache = validateCache(url, options) && useCache && isBrowser;\n\n  if (needCache) {\n    var responseCache = cache.get({\n      url: url,\n      params: params,\n      method: method\n    });\n\n    if (responseCache) {\n      responseCache = responseCache.clone();\n      responseCache.useCache = true;\n      ctx.res = responseCache;\n      return next();\n    }\n  }\n\n  var response; // 超时处理、取消请求处理\n\n  if (timeout > 0) {\n    response = Promise.race([cancel2Throw(options), adapter(url, options), timeout2Throw(timeout, ctx.req)]);\n  } else {\n    response = Promise.race([cancel2Throw(options), adapter(url, options)]);\n  } // 兼容老版本 response.interceptor\n\n\n  responseInterceptors.forEach(function (handler) {\n    response = response.then(function (res) {\n      // Fix multiple clones not working, issue: https://github.com/github/fetch/issues/504\n      var clonedRes = typeof res.clone === 'function' ? res.clone() : res;\n      return handler(clonedRes, options);\n    });\n  });\n  return response.then(function (res) {\n    // 是否存入缓存池\n    if (needCache) {\n      if (res.status === 200) {\n        var copy = res.clone();\n        copy.useCache = true;\n        cache.set({\n          url: url,\n          params: params,\n          method: method\n        }, copy, ttl);\n      }\n    }\n\n    ctx.res = res;\n    return next();\n  });\n}\n\nfunction parseResponseMiddleware(ctx, next) {\n  var copy;\n  return next().then(function () {\n    if (!ctx) return;\n    var _ctx$res = ctx.res,\n        res = _ctx$res === void 0 ? {} : _ctx$res,\n        _ctx$req = ctx.req,\n        req = _ctx$req === void 0 ? {} : _ctx$req;\n\n    var _ref = req || {},\n        _ref$options = _ref.options;\n\n    _ref$options = _ref$options === void 0 ? {} : _ref$options;\n    var _ref$options$response = _ref$options.responseType,\n        responseType = _ref$options$response === void 0 ? 'json' : _ref$options$response,\n        _ref$options$charset = _ref$options.charset,\n        charset = _ref$options$charset === void 0 ? 'utf8' : _ref$options$charset,\n        _ref$options$getRespo = _ref$options.getResponse,\n        _ref$options$throwErr = _ref$options.throwErrIfParseFail,\n        throwErrIfParseFail = _ref$options$throwErr === void 0 ? false : _ref$options$throwErr,\n        _ref$options$parseRes = _ref$options.parseResponse,\n        parseResponse = _ref$options$parseRes === void 0 ? true : _ref$options$parseRes;\n\n    if (!parseResponse) {\n      return;\n    }\n\n    if (!res || !res.clone) {\n      return;\n    } // 只在浏览器环境对 response 做克隆， node 环境如果对 response 克隆会有问题：https://github.com/bitinn/node-fetch/issues/553\n\n\n    copy = getEnv() === 'BROWSER' ? res.clone() : res;\n    copy.useCache = res.useCache || false; // 解析数据\n\n    if (charset === 'gbk') {\n      try {\n        return res.blob().then(readerGBK).then(function (d) {\n          return safeJsonParse(d, false, copy, req);\n        });\n      } catch (e) {\n        throw new ResponseError(copy, e.message, null, req, 'ParseError');\n      }\n    } else if (responseType === 'json') {\n      return res.text().then(function (d) {\n        return safeJsonParse(d, throwErrIfParseFail, copy, req);\n      });\n    }\n\n    try {\n      // 其他如text, blob, arrayBuffer, formData\n      return res[responseType]();\n    } catch (e) {\n      throw new ResponseError(copy, 'responseType not support', null, req, 'ParseError');\n    }\n  }).then(function (body) {\n    if (!ctx) return;\n    var _ctx$res2 = ctx.res,\n        _ctx$req2 = ctx.req,\n        req = _ctx$req2 === void 0 ? {} : _ctx$req2;\n\n    var _ref2 = req || {},\n        _ref2$options = _ref2.options;\n\n    _ref2$options = _ref2$options === void 0 ? {} : _ref2$options;\n    var _ref2$options$getResp = _ref2$options.getResponse,\n        getResponse = _ref2$options$getResp === void 0 ? false : _ref2$options$getResp;\n\n    if (!copy) {\n      return;\n    }\n\n    if (copy.status >= 200 && copy.status < 300) {\n      // 提供源response, 以便自定义处理\n      if (getResponse) {\n        ctx.res = {\n          data: body,\n          response: copy\n        };\n        return;\n      }\n\n      ctx.res = body;\n      return;\n    }\n\n    throw new ResponseError(copy, 'http error', body, req, 'HttpError');\n  }).catch(function (e) {\n    if (e instanceof RequestError || e instanceof ResponseError) {\n      throw e;\n    } // 对未知错误进行处理\n\n\n    var req = ctx.req,\n        res = ctx.res;\n    e.request = e.request || req;\n    e.response = e.response || res;\n    e.type = e.type || e.name;\n    e.data = e.data || undefined;\n    throw e;\n  });\n}\n\nfunction simplePostMiddleware(ctx, next) {\n  if (!ctx) return next();\n  var _ctx$req = ctx.req;\n  _ctx$req = _ctx$req === void 0 ? {} : _ctx$req;\n  var _ctx$req$options = _ctx$req.options,\n      options = _ctx$req$options === void 0 ? {} : _ctx$req$options;\n  var _options$method = options.method,\n      method = _options$method === void 0 ? 'get' : _options$method;\n\n  if (['post', 'put', 'patch', 'delete'].indexOf(method.toLowerCase()) === -1) {\n    return next();\n  }\n\n  var _options$requestType = options.requestType,\n      requestType = _options$requestType === void 0 ? 'json' : _options$requestType,\n      data = options.data; // 数据使用类axios的新字段data, 避免引用后影响旧代码, 如将body stringify多次\n\n  if (data) {\n    var dataType = Object.prototype.toString.call(data);\n\n    if (dataType === '[object Object]' || dataType === '[object Array]') {\n      if (requestType === 'json') {\n        options.headers = objectSpread({\n          Accept: 'application/json',\n          'Content-Type': 'application/json;charset=UTF-8'\n        }, options.headers);\n        options.body = JSON.stringify(data);\n      } else if (requestType === 'form') {\n        options.headers = objectSpread({\n          Accept: 'application/json',\n          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\n        }, options.headers);\n        options.body = reqStringify(data);\n      }\n    } else {\n      // 其他 requestType 自定义header\n      options.headers = objectSpread({\n        Accept: 'application/json'\n      }, options.headers);\n      options.body = data;\n    }\n  }\n\n  ctx.req.options = options;\n  return next();\n}\n\nfunction paramsSerialize(params, paramsSerializer) {\n  var serializedParams;\n  var jsonStringifiedParams; // 支持参数自动拼装，其他 method 也可用，不冲突\n\n  if (params) {\n    if (paramsSerializer) {\n      serializedParams = paramsSerializer(params);\n    } else if (isURLSearchParams(params)) {\n      serializedParams = params.toString();\n    } else {\n      if (isArray(params)) {\n        jsonStringifiedParams = [];\n        forEach2ObjArr(params, function (item) {\n          if (item === null || typeof item === 'undefined') {\n            jsonStringifiedParams.push(item);\n          } else {\n            jsonStringifiedParams.push(isObject(item) ? JSON.stringify(item) : item);\n          }\n        }); // a: [1,2,3] => a=1&a=2&a=3\n\n        serializedParams = reqStringify(jsonStringifiedParams);\n      } else {\n        jsonStringifiedParams = {};\n        forEach2ObjArr(params, function (value, key) {\n          var jsonStringifiedValue = value;\n\n          if (value === null || typeof value === 'undefined') {\n            jsonStringifiedParams[key] = value;\n          } else if (isDate(value)) {\n            jsonStringifiedValue = value.toISOString();\n          } else if (isArray(value)) {\n            jsonStringifiedValue = value;\n          } else if (isObject(value)) {\n            jsonStringifiedValue = JSON.stringify(value);\n          }\n\n          jsonStringifiedParams[key] = jsonStringifiedValue;\n        });\n        var tmp = reqStringify(jsonStringifiedParams);\n        serializedParams = tmp;\n      }\n    }\n  }\n\n  return serializedParams;\n} // 对请求参数做处理，实现 query 简化、 post 简化\n\n\nfunction simpleGetMiddleware(ctx, next) {\n  if (!ctx) return next();\n  var _ctx$req = ctx.req;\n  _ctx$req = _ctx$req === void 0 ? {} : _ctx$req;\n  var _ctx$req$options = _ctx$req.options,\n      options = _ctx$req$options === void 0 ? {} : _ctx$req$options;\n  var paramsSerializer = options.paramsSerializer,\n      params = options.params;\n  var _ctx$req2 = ctx.req;\n  _ctx$req2 = _ctx$req2 === void 0 ? {} : _ctx$req2;\n  var _ctx$req2$url = _ctx$req2.url,\n      url = _ctx$req2$url === void 0 ? '' : _ctx$req2$url; // 将 method 改为大写\n\n  options.method = options.method ? options.method.toUpperCase() : 'GET'; // 设置 credentials 默认值为 same-origin，确保当开发者没有设置时，各浏览器对请求是否发送 cookies 保持一致的行为\n  // - omit: 从不发送cookies.\n  // - same-origin: 只有当URL与响应脚本同源才发送 cookies、 HTTP Basic authentication 等验证信息.(浏览器默认值,在旧版本浏览器，例如safari 11依旧是omit，safari 12已更改)\n  // - include: 不论是不是跨域的请求,总是发送请求资源域在本地的 cookies、 HTTP Basic authentication 等验证信息.\n\n  options.credentials = options.credentials || 'same-origin'; // 支持类似axios 参数自动拼装, 其他method也可用, 不冲突.\n\n  var serializedParams = paramsSerialize(params, paramsSerializer);\n  ctx.req.originUrl = url;\n\n  if (serializedParams) {\n    var urlSign = url.indexOf('?') !== -1 ? '&' : '?';\n    ctx.req.url = \"\".concat(url).concat(urlSign).concat(serializedParams);\n  }\n\n  ctx.req.options = options;\n  return next();\n}\n\nvar globalMiddlewares = [simplePostMiddleware, simpleGetMiddleware, parseResponseMiddleware];\nvar coreMiddlewares = [fetchMiddleware];\nOnion.globalMiddlewares = globalMiddlewares;\nOnion.defaultGlobalMiddlewaresLength = globalMiddlewares.length;\nOnion.coreMiddlewares = coreMiddlewares;\nOnion.defaultCoreMiddlewaresLength = coreMiddlewares.length;\n\nvar Core = /*#__PURE__*/function () {\n  function Core(initOptions) {\n    classCallCheck(this, Core);\n    this.onion = new Onion([]);\n    this.fetchIndex = 0; // 【即将废弃】请求中间件位置\n\n    this.mapCache = new MapCache(initOptions);\n    this.initOptions = initOptions;\n    this.instanceRequestInterceptors = [];\n    this.instanceResponseInterceptors = [];\n  } // 旧版拦截器为共享\n\n\n  createClass(Core, [{\n    key: \"use\",\n    value: function use(newMiddleware) {\n      var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        global: false,\n        core: false\n      };\n      this.onion.use(newMiddleware, opt);\n      return this;\n    }\n  }, {\n    key: \"extendOptions\",\n    value: function extendOptions(options) {\n      this.initOptions = mergeRequestOptions(this.initOptions, options);\n      this.mapCache.extendOptions(options);\n    } // 执行请求前拦截器\n\n  }, {\n    key: \"dealRequestInterceptors\",\n    value: function dealRequestInterceptors(ctx) {\n      var reducer = function reducer(p1, p2) {\n        return p1.then(function () {\n          var ret = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n          ctx.req.url = ret.url || ctx.req.url;\n          ctx.req.options = ret.options || ctx.req.options;\n          return p2(ctx.req.url, ctx.req.options);\n        });\n      };\n\n      var allInterceptors = [].concat(toConsumableArray(Core.requestInterceptors), toConsumableArray(this.instanceRequestInterceptors));\n      return allInterceptors.reduce(reducer, Promise.resolve()).then(function () {\n        var ret = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        ctx.req.url = ret.url || ctx.req.url;\n        ctx.req.options = ret.options || ctx.req.options;\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"request\",\n    value: function request(url, options) {\n      var _this = this;\n\n      var onion = this.onion;\n      var obj = {\n        req: {\n          url: url,\n          options: options\n        },\n        res: null,\n        cache: this.mapCache,\n        responseInterceptors: [].concat(toConsumableArray(Core.responseInterceptors), toConsumableArray(this.instanceResponseInterceptors))\n      };\n\n      if (typeof url !== 'string') {\n        throw new Error('url MUST be a string');\n      }\n\n      return new Promise(function (resolve, reject) {\n        _this.dealRequestInterceptors(obj).then(function () {\n          return onion.execute(obj);\n        }).then(function () {\n          resolve(obj.res);\n        }).catch(function (error) {\n          var errorHandler = obj.req.options.errorHandler;\n\n          if (errorHandler) {\n            try {\n              var data = errorHandler(error);\n              resolve(data);\n            } catch (e) {\n              reject(e);\n            }\n          } else {\n            reject(error);\n          }\n        });\n      });\n    }\n  }], [{\n    key: \"requestUse\",\n    // 请求拦截器 默认 { global: true } 兼容旧版本拦截器\n    value: function requestUse(handler) {\n      var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        global: true\n      };\n      if (typeof handler !== 'function') throw new TypeError('Interceptor must be function!');\n\n      if (opt.global) {\n        Core.requestInterceptors.push(handler);\n      } else {\n        this.instanceRequestInterceptors.push(handler);\n      }\n    } // 响应拦截器 默认 { global: true } 兼容旧版本拦截器\n\n  }, {\n    key: \"responseUse\",\n    value: function responseUse(handler) {\n      var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        global: true\n      };\n      if (typeof handler !== 'function') throw new TypeError('Interceptor must be function!');\n\n      if (opt.global) {\n        Core.responseInterceptors.push(handler);\n      } else {\n        this.instanceResponseInterceptors.push(handler);\n      }\n    }\n  }]);\n  return Core;\n}();\n\nCore.requestInterceptors = [addfix];\nCore.responseInterceptors = [];\n/**\n * 当执行 “取消请求” 操作时会抛出 Cancel 对象作为一场\n * @class\n * @param {string=} message The message.\n */\n\nfunction Cancel(message) {\n  this.message = message;\n}\n\nCancel.prototype.toString = function toString() {\n  return this.message ? \"Cancel: \".concat(this.message) : 'Cancel';\n};\n\nCancel.prototype.__CANCEL__ = true;\n/**\n * 通过 CancelToken 来取消请求操作\n *\n * @class\n * @param {Function} executor The executor function.\n */\n\nfunction CancelToken(executor) {\n  if (typeof executor !== 'function') {\n    throw new TypeError('executor must be a function.');\n  }\n\n  var resolvePromise;\n  this.promise = new Promise(function promiseExecutor(resolve) {\n    resolvePromise = resolve;\n  });\n  var token = this;\n  executor(function cancel(message) {\n    if (token.reason) {\n      // 取消操作已被调用过\n      return;\n    }\n\n    token.reason = new Cancel(message);\n    resolvePromise(token.reason);\n  });\n}\n/**\n * 如果请求已经取消，抛出 Cancel 异常\n */\n\n\nCancelToken.prototype.throwIfRequested = function throwIfRequested() {\n  if (this.reason) {\n    throw this.reason;\n  }\n};\n/**\n * 通过 source 来返回 CancelToken 实例和取消 CancelToken 的函数\n */\n\n\nCancelToken.source = function source() {\n  var cancel;\n  var token = new CancelToken(function executor(c) {\n    cancel = c;\n  });\n  return {\n    token: token,\n    cancel: cancel\n  };\n};\n\nfunction isCancel(value) {\n  return !!(value && value.__CANCEL__);\n}\n\nvar request = function request() {\n  var initOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var coreInstance = new Core(initOptions);\n\n  var umiInstance = function umiInstance(url) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var mergeOptions = mergeRequestOptions(coreInstance.initOptions, options);\n    return coreInstance.request(url, mergeOptions);\n  }; // 中间件\n\n\n  umiInstance.use = coreInstance.use.bind(coreInstance);\n  umiInstance.fetchIndex = coreInstance.fetchIndex; // 拦截器\n\n  umiInstance.interceptors = {\n    request: {\n      use: Core.requestUse.bind(coreInstance)\n    },\n    response: {\n      use: Core.responseUse.bind(coreInstance)\n    }\n  }; // 请求语法糖： reguest.get request.post ……\n\n  var METHODS = ['get', 'post', 'delete', 'put', 'patch', 'head', 'options', 'rpc'];\n  METHODS.forEach(function (method) {\n    umiInstance[method] = function (url, options) {\n      return umiInstance(url, objectSpread({}, options, {\n        method: method\n      }));\n    };\n  });\n  umiInstance.Cancel = Cancel;\n  umiInstance.CancelToken = CancelToken;\n  umiInstance.isCancel = isCancel;\n  umiInstance.extendOptions = coreInstance.extendOptions.bind(coreInstance); // 暴露各个实例的中间件，供开发者自由组合\n\n  umiInstance.middlewares = {\n    instance: coreInstance.onion.middlewares,\n    defaultInstance: coreInstance.onion.defaultMiddlewares,\n    global: Onion.globalMiddlewares,\n    core: Onion.coreMiddlewares\n  };\n  return umiInstance;\n};\n/**\n * extend 方法参考了ky, 让用户可以定制配置.\n * initOpions 初始化参数\n * @param {number} maxCache 最大缓存数\n * @param {string} prefix url前缀\n * @param {function} errorHandler 统一错误处理方法\n * @param {object} headers 统一的headers\n */\n\n\nvar extend = function extend(initOptions) {\n  return request(initOptions);\n};\n/**\n * 暴露 fetch 中间件，保障依旧可以使用\n */\n\n\nvar fetch$1 = request({\n  parseResponse: false\n});\nvar request$1 = request({});\nexport default request$1;\nexport { Onion, RequestError, ResponseError, extend, fetch$1 as fetch };","map":{"version":3,"sources":["E:/github-project/cloudMusic-mobile/node_modules/umi-request/dist/index.es.js"],"names":["parse","stringify","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_objectSpread","target","i","arguments","length","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","forEach","objectSpread","_arrayWithoutHoles","arr","Array","isArray","arr2","arrayWithoutHoles","_iterableToArray","iter","Symbol","iterator","prototype","toString","call","from","iterableToArray","_nonIterableSpread","TypeError","nonIterableSpread","_toConsumableArray","toConsumableArray","_classCallCheck","instance","Constructor","classCallCheck","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","createClass","createCommonjsModule","fn","module","exports","_typeof_1","_typeof2","constructor","_typeof","compose","middlewares","middlewaresLen","wrapMiddlewares","params","next","index","dispatch","Promise","reject","Error","resolve","err","Onion","defaultMiddlewares","use","newMiddleware","opts","undefined","global","core","defaultInstance","process","env","NODE_ENV","console","warn","globalMiddlewares","splice","defaultGlobalMiddlewaresLength","coreMiddlewares","defaultCoreMiddlewaresLength","push","execute","_assertThisInitialized","self","ReferenceError","assertThisInitialized","_possibleConstructorReturn","possibleConstructorReturn","getPrototypeOf","_getPrototypeOf","o","setPrototypeOf","__proto__","_setPrototypeOf","p","_inherits","subClass","superClass","create","inherits","_isNativeFunction","Function","indexOf","isNativeFunction","construct","isNativeReflectConstruct","Reflect","sham","Proxy","Date","e","_construct","Parent","args","Class","a","apply","bind","wrapNativeSuper","_wrapNativeSuper","_cache","Map","has","get","set","Wrapper","MapCache","options","cache","timer","extendOptions","maxCache","JSON","_this","ttl","size","deleteKey","delete","clearTimeout","cacheKey","setTimeout","_delete","clear","RequestError","_Error","text","request","_this2","type","name","ResponseError","_Error2","response","data","_this3","statusText","readerGBK","file","reader","FileReader","onload","result","onerror","readAsText","safeJsonParse","throwErrIfParseFail","timeout2Throw","msec","_","cancel2Throw","opt","cancelToken","promise","then","cancel","getEnv","XMLHttpRequest","val","isURLSearchParams","URLSearchParams","isDate","isObject","forEach2ObjArr","callback","hasOwnProperty","getParamObject","strictNullHandling","reqStringify","arrayFormat","mergeRequestOptions","options2Merge","headers","method","toLowerCase","addfix","url","prefix","suffix","warnedCoreType","__defaultValidateCache","_options$method","fetchMiddleware","ctx","_ctx$req","req","_ctx$req$options","_ctx$req$url","responseInterceptors","_options$timeout","timeout","_options$__umiRequest","__umiRequestCoreType__","_options$useCache","useCache","_options$method2","_options$validateCach","validateCache","adapter","fetch","isBrowser","needCache","responseCache","clone","res","race","handler","clonedRes","status","copy","parseResponseMiddleware","_ctx$res","_ref","_ref$options","_ref$options$response","responseType","_ref$options$charset","charset","_ref$options$getRespo","getResponse","_ref$options$throwErr","_ref$options$parseRes","parseResponse","blob","d","message","body","_ctx$res2","_ctx$req2","_ref2","_ref2$options","_ref2$options$getResp","catch","simplePostMiddleware","_options$requestType","requestType","dataType","Accept","paramsSerialize","paramsSerializer","serializedParams","jsonStringifiedParams","item","jsonStringifiedValue","toISOString","tmp","simpleGetMiddleware","_ctx$req2$url","toUpperCase","credentials","originUrl","urlSign","Core","initOptions","onion","fetchIndex","mapCache","instanceRequestInterceptors","instanceResponseInterceptors","dealRequestInterceptors","reducer","p1","p2","ret","allInterceptors","requestInterceptors","reduce","error","errorHandler","requestUse","responseUse","Cancel","__CANCEL__","CancelToken","executor","resolvePromise","promiseExecutor","token","reason","throwIfRequested","c","isCancel","coreInstance","umiInstance","mergeOptions","interceptors","METHODS","extend","fetch$1","request$1"],"mappings":"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","sourcesContent":["import { parse, stringify } from 'qs';\nimport 'isomorphic-fetch';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar defineProperty = _defineProperty;\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nvar objectSpread = _objectSpread;\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nvar arrayWithoutHoles = _arrayWithoutHoles;\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nvar iterableToArray = _iterableToArray;\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar nonIterableSpread = _nonIterableSpread;\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}\n\nvar toConsumableArray = _toConsumableArray;\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar classCallCheck = _classCallCheck;\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar createClass = _createClass;\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar _typeof_1 = createCommonjsModule(function (module) {\nfunction _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;\n});\n\n// 返回一个组合了所有插件的“插件”\nfunction compose(middlewares) {\n  if (!Array.isArray(middlewares)) throw new TypeError('Middlewares must be an array!');\n  var middlewaresLen = middlewares.length;\n\n  for (var i = 0; i < middlewaresLen; i++) {\n    if (typeof middlewares[i] !== 'function') {\n      throw new TypeError('Middleware must be componsed of function');\n    }\n  }\n\n  return function wrapMiddlewares(params, next) {\n    var index = -1;\n\n    function dispatch(i) {\n      if (i <= index) {\n        return Promise.reject(new Error('next() should not be called multiple times in one middleware!'));\n      }\n\n      index = i;\n      var fn = middlewares[i] || next;\n      if (!fn) return Promise.resolve();\n\n      try {\n        return Promise.resolve(fn(params, function () {\n          return dispatch(i + 1);\n        }));\n      } catch (err) {\n        return Promise.reject(err);\n      }\n    }\n\n    return dispatch(0);\n  };\n}\n\nvar Onion =\n/*#__PURE__*/\nfunction () {\n  function Onion(defaultMiddlewares) {\n    classCallCheck(this, Onion);\n\n    if (!Array.isArray(defaultMiddlewares)) throw new TypeError('Default middlewares must be an array!');\n    this.defaultMiddlewares = toConsumableArray(defaultMiddlewares);\n    this.middlewares = [];\n  }\n\n  createClass(Onion, [{\n    key: \"use\",\n    // 内置内核中间件长度\n    value: function use(newMiddleware) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        global: false,\n        core: false,\n        defaultInstance: false\n      };\n      var core = false;\n      var global = false;\n      var defaultInstance = false;\n\n      if (typeof opts === 'number') {\n        if (process && process.env && process.env.NODE_ENV === 'development') {\n          console.warn('use() options should be object, number property would be deprecated in future，please update use() options to \"{ core: true }\".');\n        }\n\n        core = true;\n        global = false;\n      } else if (_typeof_1(opts) === 'object' && opts) {\n        global = opts.global || false;\n        core = opts.core || false;\n        defaultInstance = opts.defaultInstance || false;\n      } // 全局中间件\n\n\n      if (global) {\n        Onion.globalMiddlewares.splice(Onion.globalMiddlewares.length - Onion.defaultGlobalMiddlewaresLength, 0, newMiddleware);\n        return;\n      } // 内核中间件\n\n\n      if (core) {\n        Onion.coreMiddlewares.splice(Onion.coreMiddlewares.length - Onion.defaultCoreMiddlewaresLength, 0, newMiddleware);\n        return;\n      } // 默认实例中间件，供开发者使用\n\n\n      if (defaultInstance) {\n        this.defaultMiddlewares.push(newMiddleware);\n        return;\n      } // 实例中间件\n\n\n      this.middlewares.push(newMiddleware);\n    }\n  }, {\n    key: \"execute\",\n    value: function execute() {\n      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var fn = compose([].concat(toConsumableArray(this.middlewares), toConsumableArray(this.defaultMiddlewares), toConsumableArray(Onion.globalMiddlewares), toConsumableArray(Onion.coreMiddlewares)));\n      return fn(params);\n    }\n  }]);\n\n  return Onion;\n}();\n\nOnion.globalMiddlewares = [];\nOnion.defaultGlobalMiddlewaresLength = 0;\nOnion.coreMiddlewares = [];\nOnion.defaultCoreMiddlewaresLength = 0;\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nvar assertThisInitialized = _assertThisInitialized;\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof_1(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nvar possibleConstructorReturn = _possibleConstructorReturn;\n\nvar getPrototypeOf = createCommonjsModule(function (module) {\nfunction _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;\n});\n\nvar setPrototypeOf = createCommonjsModule(function (module) {\nfunction _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;\n});\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nvar inherits = _inherits;\n\nfunction _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nvar isNativeFunction = _isNativeFunction;\n\nvar construct = createCommonjsModule(function (module) {\nfunction isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    module.exports = _construct = Reflect.construct;\n  } else {\n    module.exports = _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nmodule.exports = _construct;\n});\n\nvar wrapNativeSuper = createCommonjsModule(function (module) {\nfunction _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  module.exports = _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return construct(Class, arguments, getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}\n\nmodule.exports = _wrapNativeSuper;\n});\n\nvar MapCache =\n/*#__PURE__*/\nfunction () {\n  function MapCache(options) {\n    classCallCheck(this, MapCache);\n\n    this.cache = new Map();\n    this.timer = {};\n    this.extendOptions(options);\n  }\n\n  createClass(MapCache, [{\n    key: \"extendOptions\",\n    value: function extendOptions(options) {\n      this.maxCache = options.maxCache || 0;\n    }\n  }, {\n    key: \"get\",\n    value: function get(key) {\n      return this.cache.get(JSON.stringify(key));\n    }\n  }, {\n    key: \"set\",\n    value: function set(key, value) {\n      var _this = this;\n\n      var ttl = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 60000;\n\n      // 如果超过最大缓存数, 删除头部的第一个缓存.\n      if (this.maxCache > 0 && this.cache.size >= this.maxCache) {\n        var deleteKey = toConsumableArray(this.cache.keys())[0];\n\n        this.cache.delete(deleteKey);\n\n        if (this.timer[deleteKey]) {\n          clearTimeout(this.timer[deleteKey]);\n        }\n      }\n\n      var cacheKey = JSON.stringify(key);\n      this.cache.set(cacheKey, value);\n\n      if (ttl > 0) {\n        this.timer[cacheKey] = setTimeout(function () {\n          _this.cache.delete(cacheKey);\n\n          delete _this.timer[cacheKey];\n        }, ttl);\n      }\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(key) {\n      var cacheKey = JSON.stringify(key);\n      delete this.timer[cacheKey];\n      return this.cache.delete(cacheKey);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.timer = {};\n      return this.cache.clear();\n    }\n  }]);\n\n  return MapCache;\n}();\n/**\n * 请求异常\n */\n\nvar RequestError =\n/*#__PURE__*/\nfunction (_Error) {\n  inherits(RequestError, _Error);\n\n  function RequestError(text, request) {\n    var _this2;\n\n    var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'RequestError';\n\n    classCallCheck(this, RequestError);\n\n    _this2 = possibleConstructorReturn(this, getPrototypeOf(RequestError).call(this, text));\n    _this2.name = 'RequestError';\n    _this2.request = request;\n    _this2.type = type;\n    return _this2;\n  }\n\n  return RequestError;\n}(wrapNativeSuper(Error));\n/**\n * 响应异常\n */\n\nvar ResponseError =\n/*#__PURE__*/\nfunction (_Error2) {\n  inherits(ResponseError, _Error2);\n\n  function ResponseError(response, text, data, request) {\n    var _this3;\n\n    var type = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'ResponseError';\n\n    classCallCheck(this, ResponseError);\n\n    _this3 = possibleConstructorReturn(this, getPrototypeOf(ResponseError).call(this, text || response.statusText));\n    _this3.name = 'ResponseError';\n    _this3.data = data;\n    _this3.response = response;\n    _this3.request = request;\n    _this3.type = type;\n    return _this3;\n  }\n\n  return ResponseError;\n}(wrapNativeSuper(Error));\n/**\n * http://gitlab.alipay-inc.com/KBSJ/gxt/blob/release_gxt_S8928905_20180531/src/util/request.js#L63\n * 支持gbk\n */\n\nfunction readerGBK(file) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n\n    reader.onload = function () {\n      resolve(reader.result);\n    };\n\n    reader.onerror = reject;\n    reader.readAsText(file, 'GBK'); // setup GBK decoding\n  });\n}\n/**\n * 安全的JSON.parse\n */\n\nfunction safeJsonParse(data) {\n  var throwErrIfParseFail = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var response = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var request = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  try {\n    return JSON.parse(data);\n  } catch (e) {\n    if (throwErrIfParseFail) {\n      throw new ResponseError(response, 'JSON.parse fail', data, request, 'ParseError');\n    }\n  } // eslint-disable-line no-empty\n\n\n  return data;\n}\nfunction timeout2Throw(msec, request) {\n  return new Promise(function (_, reject) {\n    setTimeout(function () {\n      reject(new RequestError(\"timeout of \".concat(msec, \"ms exceeded\"), request, 'Timeout'));\n    }, msec);\n  });\n} // If request options contain 'cancelToken', reject request when token has been canceled\n\nfunction cancel2Throw(opt) {\n  return new Promise(function (_, reject) {\n    if (opt.cancelToken) {\n      opt.cancelToken.promise.then(function (cancel) {\n        reject(cancel);\n      });\n    }\n  });\n}\nvar toString = Object.prototype.toString; // Check env is browser or node\n\nfunction getEnv() {\n  var env; // Only Node.JS has a process variable that is of [[Class]] process\n\n  if (typeof process !== 'undefined' && toString.call(process) === '[object process]') {\n    // For node use HTTP adapter\n    env = 'NODE';\n  }\n\n  if (typeof XMLHttpRequest !== 'undefined') {\n    env = 'BROWSER';\n  }\n\n  return env;\n}\nfunction isArray(val) {\n  return _typeof_1(val) === 'object' && Object.prototype.toString.call(val) === '[object Array]';\n}\nfunction isURLSearchParams(val) {\n  return typeof URLSearchParams !== 'undefined' && val instanceof URLSearchParams;\n}\nfunction isDate(val) {\n  return _typeof_1(val) === 'object' && Object.prototype.toString.call(val) === '[object Date]';\n}\nfunction isObject(val) {\n  return val !== null && _typeof_1(val) === 'object';\n}\nfunction forEach2ObjArr(target, callback) {\n  if (!target) return;\n\n  if (_typeof_1(target) !== 'object') {\n    target = [target];\n  }\n\n  if (isArray(target)) {\n    for (var i = 0; i < target.length; i++) {\n      callback.call(null, target[i], i, target);\n    }\n  } else {\n    for (var key in target) {\n      if (Object.prototype.hasOwnProperty.call(target, key)) {\n        callback.call(null, target[key], key, target);\n      }\n    }\n  }\n}\nfunction getParamObject(val) {\n  if (isURLSearchParams(val)) {\n    return parse(val.toString(), {\n      strictNullHandling: true\n    });\n  }\n\n  if (typeof val === 'string') {\n    return [val];\n  }\n\n  return val;\n}\nfunction reqStringify(val) {\n  return stringify(val, {\n    arrayFormat: 'repeat',\n    strictNullHandling: true\n  });\n}\nfunction mergeRequestOptions(options, options2Merge) {\n  return objectSpread({}, options, options2Merge, {\n    headers: objectSpread({}, options.headers, options2Merge.headers),\n    params: objectSpread({}, getParamObject(options.params), getParamObject(options2Merge.params)),\n    method: (options2Merge.method || options.method || 'get').toLowerCase()\n  });\n}\n\n// 前后缀拦截\nvar addfix = function addfix(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var prefix = options.prefix,\n      suffix = options.suffix;\n\n  if (prefix) {\n    url = \"\".concat(prefix).concat(url);\n  }\n\n  if (suffix) {\n    url = \"\".concat(url).concat(suffix);\n  }\n\n  return {\n    url: url,\n    options: options\n  };\n};\n\nvar warnedCoreType = false; // 默认缓存判断，开放缓存判断给非 get 请求使用\n\nfunction __defaultValidateCache(url, options) {\n  var _options$method = options.method,\n      method = _options$method === void 0 ? 'get' : _options$method;\n  return method.toLowerCase() === 'get';\n}\n\nfunction fetchMiddleware(ctx, next) {\n  if (!ctx) return next();\n  var _ctx$req = ctx.req;\n  _ctx$req = _ctx$req === void 0 ? {} : _ctx$req;\n  var _ctx$req$options = _ctx$req.options,\n      options = _ctx$req$options === void 0 ? {} : _ctx$req$options,\n      _ctx$req$url = _ctx$req.url,\n      url = _ctx$req$url === void 0 ? '' : _ctx$req$url,\n      cache = ctx.cache,\n      responseInterceptors = ctx.responseInterceptors;\n\n  var _options$timeout = options.timeout,\n      timeout = _options$timeout === void 0 ? 0 : _options$timeout,\n      _options$__umiRequest = options.__umiRequestCoreType__,\n      __umiRequestCoreType__ = _options$__umiRequest === void 0 ? 'normal' : _options$__umiRequest,\n      _options$useCache = options.useCache,\n      useCache = _options$useCache === void 0 ? false : _options$useCache,\n      _options$method2 = options.method,\n      method = _options$method2 === void 0 ? 'get' : _options$method2,\n      params = options.params,\n      ttl = options.ttl,\n      _options$validateCach = options.validateCache,\n      validateCache = _options$validateCach === void 0 ? __defaultValidateCache : _options$validateCach;\n\n  if (__umiRequestCoreType__ !== 'normal') {\n    if (process && process.env && process.env.NODE_ENV === 'development' && warnedCoreType === false) {\n      warnedCoreType = true;\n      console.warn('__umiRequestCoreType__ is a internal property that use in umi-request, change its value would affect the behavior of request! It only use when you want to extend or use request core.');\n    }\n\n    return next();\n  }\n\n  var adapter = fetch;\n\n  if (!adapter) {\n    throw new Error('Global fetch not exist!');\n  } // 从缓存池检查是否有缓存数据\n\n\n  var isBrowser = getEnv() === 'BROWSER';\n  var needCache = validateCache(url, options) && useCache && isBrowser;\n\n  if (needCache) {\n    var responseCache = cache.get({\n      url: url,\n      params: params,\n      method: method\n    });\n\n    if (responseCache) {\n      responseCache = responseCache.clone();\n      responseCache.useCache = true;\n      ctx.res = responseCache;\n      return next();\n    }\n  }\n\n  var response; // 超时处理、取消请求处理\n\n  if (timeout > 0) {\n    response = Promise.race([cancel2Throw(options), adapter(url, options), timeout2Throw(timeout, ctx.req)]);\n  } else {\n    response = Promise.race([cancel2Throw(options), adapter(url, options)]);\n  } // 兼容老版本 response.interceptor\n\n\n  responseInterceptors.forEach(function (handler) {\n    response = response.then(function (res) {\n      // Fix multiple clones not working, issue: https://github.com/github/fetch/issues/504\n      var clonedRes = typeof res.clone === 'function' ? res.clone() : res;\n      return handler(clonedRes, options);\n    });\n  });\n  return response.then(function (res) {\n    // 是否存入缓存池\n    if (needCache) {\n      if (res.status === 200) {\n        var copy = res.clone();\n        copy.useCache = true;\n        cache.set({\n          url: url,\n          params: params,\n          method: method\n        }, copy, ttl);\n      }\n    }\n\n    ctx.res = res;\n    return next();\n  });\n}\n\nfunction parseResponseMiddleware(ctx, next) {\n  var copy;\n  return next().then(function () {\n    if (!ctx) return;\n    var _ctx$res = ctx.res,\n        res = _ctx$res === void 0 ? {} : _ctx$res,\n        _ctx$req = ctx.req,\n        req = _ctx$req === void 0 ? {} : _ctx$req;\n\n    var _ref = req || {},\n        _ref$options = _ref.options;\n\n    _ref$options = _ref$options === void 0 ? {} : _ref$options;\n    var _ref$options$response = _ref$options.responseType,\n        responseType = _ref$options$response === void 0 ? 'json' : _ref$options$response,\n        _ref$options$charset = _ref$options.charset,\n        charset = _ref$options$charset === void 0 ? 'utf8' : _ref$options$charset,\n        _ref$options$getRespo = _ref$options.getResponse,\n        _ref$options$throwErr = _ref$options.throwErrIfParseFail,\n        throwErrIfParseFail = _ref$options$throwErr === void 0 ? false : _ref$options$throwErr,\n        _ref$options$parseRes = _ref$options.parseResponse,\n        parseResponse = _ref$options$parseRes === void 0 ? true : _ref$options$parseRes;\n\n    if (!parseResponse) {\n      return;\n    }\n\n    if (!res || !res.clone) {\n      return;\n    } // 只在浏览器环境对 response 做克隆， node 环境如果对 response 克隆会有问题：https://github.com/bitinn/node-fetch/issues/553\n\n\n    copy = getEnv() === 'BROWSER' ? res.clone() : res;\n    copy.useCache = res.useCache || false; // 解析数据\n\n    if (charset === 'gbk') {\n      try {\n        return res.blob().then(readerGBK).then(function (d) {\n          return safeJsonParse(d, false, copy, req);\n        });\n      } catch (e) {\n        throw new ResponseError(copy, e.message, null, req, 'ParseError');\n      }\n    } else if (responseType === 'json') {\n      return res.text().then(function (d) {\n        return safeJsonParse(d, throwErrIfParseFail, copy, req);\n      });\n    }\n\n    try {\n      // 其他如text, blob, arrayBuffer, formData\n      return res[responseType]();\n    } catch (e) {\n      throw new ResponseError(copy, 'responseType not support', null, req, 'ParseError');\n    }\n  }).then(function (body) {\n    if (!ctx) return;\n    var _ctx$res2 = ctx.res,\n        _ctx$req2 = ctx.req,\n        req = _ctx$req2 === void 0 ? {} : _ctx$req2;\n\n    var _ref2 = req || {},\n        _ref2$options = _ref2.options;\n\n    _ref2$options = _ref2$options === void 0 ? {} : _ref2$options;\n    var _ref2$options$getResp = _ref2$options.getResponse,\n        getResponse = _ref2$options$getResp === void 0 ? false : _ref2$options$getResp;\n\n    if (!copy) {\n      return;\n    }\n\n    if (copy.status >= 200 && copy.status < 300) {\n      // 提供源response, 以便自定义处理\n      if (getResponse) {\n        ctx.res = {\n          data: body,\n          response: copy\n        };\n        return;\n      }\n\n      ctx.res = body;\n      return;\n    }\n\n    throw new ResponseError(copy, 'http error', body, req, 'HttpError');\n  }).catch(function (e) {\n    if (e instanceof RequestError || e instanceof ResponseError) {\n      throw e;\n    } // 对未知错误进行处理\n\n\n    var req = ctx.req,\n        res = ctx.res;\n    e.request = e.request || req;\n    e.response = e.response || res;\n    e.type = e.type || e.name;\n    e.data = e.data || undefined;\n    throw e;\n  });\n}\n\nfunction simplePostMiddleware(ctx, next) {\n  if (!ctx) return next();\n  var _ctx$req = ctx.req;\n  _ctx$req = _ctx$req === void 0 ? {} : _ctx$req;\n  var _ctx$req$options = _ctx$req.options,\n      options = _ctx$req$options === void 0 ? {} : _ctx$req$options;\n  var _options$method = options.method,\n      method = _options$method === void 0 ? 'get' : _options$method;\n\n  if (['post', 'put', 'patch', 'delete'].indexOf(method.toLowerCase()) === -1) {\n    return next();\n  }\n\n  var _options$requestType = options.requestType,\n      requestType = _options$requestType === void 0 ? 'json' : _options$requestType,\n      data = options.data; // 数据使用类axios的新字段data, 避免引用后影响旧代码, 如将body stringify多次\n\n  if (data) {\n    var dataType = Object.prototype.toString.call(data);\n\n    if (dataType === '[object Object]' || dataType === '[object Array]') {\n      if (requestType === 'json') {\n        options.headers = objectSpread({\n          Accept: 'application/json',\n          'Content-Type': 'application/json;charset=UTF-8'\n        }, options.headers);\n        options.body = JSON.stringify(data);\n      } else if (requestType === 'form') {\n        options.headers = objectSpread({\n          Accept: 'application/json',\n          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\n        }, options.headers);\n        options.body = reqStringify(data);\n      }\n    } else {\n      // 其他 requestType 自定义header\n      options.headers = objectSpread({\n        Accept: 'application/json'\n      }, options.headers);\n      options.body = data;\n    }\n  }\n\n  ctx.req.options = options;\n  return next();\n}\n\nfunction paramsSerialize(params, paramsSerializer) {\n  var serializedParams;\n  var jsonStringifiedParams; // 支持参数自动拼装，其他 method 也可用，不冲突\n\n  if (params) {\n    if (paramsSerializer) {\n      serializedParams = paramsSerializer(params);\n    } else if (isURLSearchParams(params)) {\n      serializedParams = params.toString();\n    } else {\n      if (isArray(params)) {\n        jsonStringifiedParams = [];\n        forEach2ObjArr(params, function (item) {\n          if (item === null || typeof item === 'undefined') {\n            jsonStringifiedParams.push(item);\n          } else {\n            jsonStringifiedParams.push(isObject(item) ? JSON.stringify(item) : item);\n          }\n        }); // a: [1,2,3] => a=1&a=2&a=3\n\n        serializedParams = reqStringify(jsonStringifiedParams);\n      } else {\n        jsonStringifiedParams = {};\n        forEach2ObjArr(params, function (value, key) {\n          var jsonStringifiedValue = value;\n\n          if (value === null || typeof value === 'undefined') {\n            jsonStringifiedParams[key] = value;\n          } else if (isDate(value)) {\n            jsonStringifiedValue = value.toISOString();\n          } else if (isArray(value)) {\n            jsonStringifiedValue = value;\n          } else if (isObject(value)) {\n            jsonStringifiedValue = JSON.stringify(value);\n          }\n\n          jsonStringifiedParams[key] = jsonStringifiedValue;\n        });\n        var tmp = reqStringify(jsonStringifiedParams);\n        serializedParams = tmp;\n      }\n    }\n  }\n\n  return serializedParams;\n} // 对请求参数做处理，实现 query 简化、 post 简化\n\nfunction simpleGetMiddleware(ctx, next) {\n  if (!ctx) return next();\n  var _ctx$req = ctx.req;\n  _ctx$req = _ctx$req === void 0 ? {} : _ctx$req;\n  var _ctx$req$options = _ctx$req.options,\n      options = _ctx$req$options === void 0 ? {} : _ctx$req$options;\n  var paramsSerializer = options.paramsSerializer,\n      params = options.params;\n  var _ctx$req2 = ctx.req;\n  _ctx$req2 = _ctx$req2 === void 0 ? {} : _ctx$req2;\n  var _ctx$req2$url = _ctx$req2.url,\n      url = _ctx$req2$url === void 0 ? '' : _ctx$req2$url; // 将 method 改为大写\n\n  options.method = options.method ? options.method.toUpperCase() : 'GET'; // 设置 credentials 默认值为 same-origin，确保当开发者没有设置时，各浏览器对请求是否发送 cookies 保持一致的行为\n  // - omit: 从不发送cookies.\n  // - same-origin: 只有当URL与响应脚本同源才发送 cookies、 HTTP Basic authentication 等验证信息.(浏览器默认值,在旧版本浏览器，例如safari 11依旧是omit，safari 12已更改)\n  // - include: 不论是不是跨域的请求,总是发送请求资源域在本地的 cookies、 HTTP Basic authentication 等验证信息.\n\n  options.credentials = options.credentials || 'same-origin'; // 支持类似axios 参数自动拼装, 其他method也可用, 不冲突.\n\n  var serializedParams = paramsSerialize(params, paramsSerializer);\n  ctx.req.originUrl = url;\n\n  if (serializedParams) {\n    var urlSign = url.indexOf('?') !== -1 ? '&' : '?';\n    ctx.req.url = \"\".concat(url).concat(urlSign).concat(serializedParams);\n  }\n\n  ctx.req.options = options;\n  return next();\n}\n\nvar globalMiddlewares = [simplePostMiddleware, simpleGetMiddleware, parseResponseMiddleware];\nvar coreMiddlewares = [fetchMiddleware];\nOnion.globalMiddlewares = globalMiddlewares;\nOnion.defaultGlobalMiddlewaresLength = globalMiddlewares.length;\nOnion.coreMiddlewares = coreMiddlewares;\nOnion.defaultCoreMiddlewaresLength = coreMiddlewares.length;\n\nvar Core =\n/*#__PURE__*/\nfunction () {\n  function Core(initOptions) {\n    classCallCheck(this, Core);\n\n    this.onion = new Onion([]);\n    this.fetchIndex = 0; // 【即将废弃】请求中间件位置\n\n    this.mapCache = new MapCache(initOptions);\n    this.initOptions = initOptions;\n    this.instanceRequestInterceptors = [];\n    this.instanceResponseInterceptors = [];\n  } // 旧版拦截器为共享\n\n\n  createClass(Core, [{\n    key: \"use\",\n    value: function use(newMiddleware) {\n      var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        global: false,\n        core: false\n      };\n      this.onion.use(newMiddleware, opt);\n      return this;\n    }\n  }, {\n    key: \"extendOptions\",\n    value: function extendOptions(options) {\n      this.initOptions = mergeRequestOptions(this.initOptions, options);\n      this.mapCache.extendOptions(options);\n    } // 执行请求前拦截器\n\n  }, {\n    key: \"dealRequestInterceptors\",\n    value: function dealRequestInterceptors(ctx) {\n      var reducer = function reducer(p1, p2) {\n        return p1.then(function () {\n          var ret = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n          ctx.req.url = ret.url || ctx.req.url;\n          ctx.req.options = ret.options || ctx.req.options;\n          return p2(ctx.req.url, ctx.req.options);\n        });\n      };\n\n      var allInterceptors = [].concat(toConsumableArray(Core.requestInterceptors), toConsumableArray(this.instanceRequestInterceptors));\n      return allInterceptors.reduce(reducer, Promise.resolve()).then(function () {\n        var ret = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        ctx.req.url = ret.url || ctx.req.url;\n        ctx.req.options = ret.options || ctx.req.options;\n        return Promise.resolve();\n      });\n    }\n  }, {\n    key: \"request\",\n    value: function request(url, options) {\n      var _this = this;\n\n      var onion = this.onion;\n      var obj = {\n        req: {\n          url: url,\n          options: options\n        },\n        res: null,\n        cache: this.mapCache,\n        responseInterceptors: [].concat(toConsumableArray(Core.responseInterceptors), toConsumableArray(this.instanceResponseInterceptors))\n      };\n\n      if (typeof url !== 'string') {\n        throw new Error('url MUST be a string');\n      }\n\n      return new Promise(function (resolve, reject) {\n        _this.dealRequestInterceptors(obj).then(function () {\n          return onion.execute(obj);\n        }).then(function () {\n          resolve(obj.res);\n        }).catch(function (error) {\n          var errorHandler = obj.req.options.errorHandler;\n\n          if (errorHandler) {\n            try {\n              var data = errorHandler(error);\n              resolve(data);\n            } catch (e) {\n              reject(e);\n            }\n          } else {\n            reject(error);\n          }\n        });\n      });\n    }\n  }], [{\n    key: \"requestUse\",\n    // 请求拦截器 默认 { global: true } 兼容旧版本拦截器\n    value: function requestUse(handler) {\n      var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        global: true\n      };\n      if (typeof handler !== 'function') throw new TypeError('Interceptor must be function!');\n\n      if (opt.global) {\n        Core.requestInterceptors.push(handler);\n      } else {\n        this.instanceRequestInterceptors.push(handler);\n      }\n    } // 响应拦截器 默认 { global: true } 兼容旧版本拦截器\n\n  }, {\n    key: \"responseUse\",\n    value: function responseUse(handler) {\n      var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        global: true\n      };\n      if (typeof handler !== 'function') throw new TypeError('Interceptor must be function!');\n\n      if (opt.global) {\n        Core.responseInterceptors.push(handler);\n      } else {\n        this.instanceResponseInterceptors.push(handler);\n      }\n    }\n  }]);\n\n  return Core;\n}();\n\nCore.requestInterceptors = [addfix];\nCore.responseInterceptors = [];\n\n/**\n * 当执行 “取消请求” 操作时会抛出 Cancel 对象作为一场\n * @class\n * @param {string=} message The message.\n */\n\nfunction Cancel(message) {\n  this.message = message;\n}\n\nCancel.prototype.toString = function toString() {\n  return this.message ? \"Cancel: \".concat(this.message) : 'Cancel';\n};\n\nCancel.prototype.__CANCEL__ = true;\n\n/**\n * 通过 CancelToken 来取消请求操作\n *\n * @class\n * @param {Function} executor The executor function.\n */\n\nfunction CancelToken(executor) {\n  if (typeof executor !== 'function') {\n    throw new TypeError('executor must be a function.');\n  }\n\n  var resolvePromise;\n  this.promise = new Promise(function promiseExecutor(resolve) {\n    resolvePromise = resolve;\n  });\n  var token = this;\n  executor(function cancel(message) {\n    if (token.reason) {\n      // 取消操作已被调用过\n      return;\n    }\n\n    token.reason = new Cancel(message);\n    resolvePromise(token.reason);\n  });\n}\n/**\n * 如果请求已经取消，抛出 Cancel 异常\n */\n\n\nCancelToken.prototype.throwIfRequested = function throwIfRequested() {\n  if (this.reason) {\n    throw this.reason;\n  }\n};\n/**\n * 通过 source 来返回 CancelToken 实例和取消 CancelToken 的函数\n */\n\n\nCancelToken.source = function source() {\n  var cancel;\n  var token = new CancelToken(function executor(c) {\n    cancel = c;\n  });\n  return {\n    token: token,\n    cancel: cancel\n  };\n};\n\nfunction isCancel(value) {\n  return !!(value && value.__CANCEL__);\n}\n\nvar request = function request() {\n  var initOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var coreInstance = new Core(initOptions);\n\n  var umiInstance = function umiInstance(url) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var mergeOptions = mergeRequestOptions(coreInstance.initOptions, options);\n    return coreInstance.request(url, mergeOptions);\n  }; // 中间件\n\n\n  umiInstance.use = coreInstance.use.bind(coreInstance);\n  umiInstance.fetchIndex = coreInstance.fetchIndex; // 拦截器\n\n  umiInstance.interceptors = {\n    request: {\n      use: Core.requestUse.bind(coreInstance)\n    },\n    response: {\n      use: Core.responseUse.bind(coreInstance)\n    }\n  }; // 请求语法糖： reguest.get request.post ……\n\n  var METHODS = ['get', 'post', 'delete', 'put', 'patch', 'head', 'options', 'rpc'];\n  METHODS.forEach(function (method) {\n    umiInstance[method] = function (url, options) {\n      return umiInstance(url, objectSpread({}, options, {\n        method: method\n      }));\n    };\n  });\n  umiInstance.Cancel = Cancel;\n  umiInstance.CancelToken = CancelToken;\n  umiInstance.isCancel = isCancel;\n  umiInstance.extendOptions = coreInstance.extendOptions.bind(coreInstance); // 暴露各个实例的中间件，供开发者自由组合\n\n  umiInstance.middlewares = {\n    instance: coreInstance.onion.middlewares,\n    defaultInstance: coreInstance.onion.defaultMiddlewares,\n    global: Onion.globalMiddlewares,\n    core: Onion.coreMiddlewares\n  };\n  return umiInstance;\n};\n/**\n * extend 方法参考了ky, 让用户可以定制配置.\n * initOpions 初始化参数\n * @param {number} maxCache 最大缓存数\n * @param {string} prefix url前缀\n * @param {function} errorHandler 统一错误处理方法\n * @param {object} headers 统一的headers\n */\n\n\nvar extend = function extend(initOptions) {\n  return request(initOptions);\n};\n/**\n * 暴露 fetch 中间件，保障依旧可以使用\n */\n\nvar fetch$1 = request({\n  parseResponse: false\n});\nvar request$1 = request({});\n\nexport default request$1;\nexport { Onion, RequestError, ResponseError, extend, fetch$1 as fetch };\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"function _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nimport { useEffect, useState, useMemo } from 'react';\nimport useSize from '../useSize';\nexport default (function (list, options) {\n  var _useSize = useSize(),\n      _useSize2 = _slicedToArray(_useSize, 2),\n      size = _useSize2[0],\n      containerRef = _useSize2[1]; // 暂时禁止 cache\n  // const distanceCache = useRef<{ [key: number]: number }>({});\n\n\n  var _useState = useState({\n    start: 0,\n    end: 10\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var itemHeight = options.itemHeight,\n      _options$overscan = options.overscan,\n      overscan = _options$overscan === void 0 ? 5 : _options$overscan;\n\n  if (!itemHeight) {\n    console.warn('please enter a valid itemHeight');\n  }\n\n  var getViewCapacity = function getViewCapacity(containerHeight) {\n    if (typeof itemHeight === 'number') {\n      return Math.ceil(containerHeight / itemHeight);\n    }\n\n    var _state$start = state.start,\n        start = _state$start === void 0 ? 0 : _state$start;\n    var sum = 0;\n    var capacity = 0;\n\n    for (var i = start; i < list.length; i++) {\n      var height = itemHeight(i);\n      sum += height;\n\n      if (sum >= containerHeight) {\n        capacity = i;\n        break;\n      }\n    }\n\n    return capacity - start;\n  };\n\n  var getOffset = function getOffset(scrollTop) {\n    if (typeof itemHeight === 'number') {\n      return Math.floor(scrollTop / itemHeight) + 1;\n    }\n\n    var sum = 0;\n    var offset = 0;\n\n    for (var i = 0; i < list.length; i++) {\n      var height = itemHeight(i);\n      sum += height;\n\n      if (sum >= scrollTop) {\n        offset = i;\n        break;\n      }\n    }\n\n    return offset + 1;\n  };\n\n  var calculateRange = function calculateRange() {\n    var element = containerRef.current;\n\n    if (element) {\n      var offset = getOffset(element.scrollTop);\n      var viewCapacity = getViewCapacity(element.clientHeight);\n      var from = offset - overscan;\n      var to = offset + viewCapacity + overscan;\n      setState({\n        start: from < 0 ? 0 : from,\n        end: to > list.length ? list.length : to\n      });\n    }\n  };\n\n  useEffect(function () {\n    calculateRange();\n  }, [size.width, size.height]);\n  var totalHeight = useMemo(function () {\n    if (typeof itemHeight === 'number') {\n      return list.length * itemHeight;\n    }\n\n    return list.reduce(function (sum, _, index) {\n      return sum + itemHeight(index);\n    }, 0);\n  }, [list.length]);\n\n  var getDistanceTop = function getDistanceTop(index) {\n    // 如果有缓存，优先返回缓存值\n    // if (enableCache && distanceCache.current[index]) {\n    //   return distanceCache.current[index];\n    // }\n    if (typeof itemHeight === 'number') {\n      var _height = index * itemHeight; // if (enableCache) {\n      //   distanceCache.current[index] = height;\n      // }\n\n\n      return _height;\n    }\n\n    var height = list.slice(0, index).reduce(function (sum, _, i) {\n      return sum + itemHeight(i);\n    }, 0); // if (enableCache) {\n    //   distanceCache.current[index] = height;\n    // }\n\n    return height;\n  };\n\n  var scrollTo = function scrollTo(index) {\n    if (containerRef.current) {\n      containerRef.current.scrollTop = getDistanceTop(index);\n      calculateRange();\n    }\n  };\n\n  return {\n    list: list.slice(state.start, state.end).map(function (ele, index) {\n      return {\n        data: ele,\n        index: index + state.start\n      };\n    }),\n    scrollTo: scrollTo,\n    containerProps: {\n      ref: function ref(ele) {\n        containerRef.current = ele;\n      },\n      onScroll: function onScroll(e) {\n        e.preventDefault();\n        calculateRange();\n      },\n      style: {\n        overflowY: 'auto'\n      }\n    },\n    wrapperProps: {\n      style: {\n        width: '100%',\n        height: totalHeight,\n        paddingTop: getDistanceTop(state.start)\n      }\n    }\n  };\n});","map":{"version":3,"sources":["E:/github-project/cloudMusic-mobile/node_modules/@umijs/hooks/es/useVirtualList/index.js"],"names":["_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","TypeError","Symbol","iterator","Object","prototype","toString","call","_arr","_n","_d","_e","undefined","_i","_s","next","done","push","value","length","err","Array","isArray","useEffect","useState","useMemo","useSize","list","options","_useSize","_useSize2","size","containerRef","_useState","start","end","_useState2","state","setState","itemHeight","_options$overscan","overscan","console","warn","getViewCapacity","containerHeight","Math","ceil","_state$start","sum","capacity","height","getOffset","scrollTop","floor","offset","calculateRange","element","current","viewCapacity","clientHeight","from","to","width","totalHeight","reduce","_","index","getDistanceTop","_height","slice","scrollTo","map","ele","data","containerProps","ref","onScroll","e","preventDefault","style","overflowY","wrapperProps","paddingTop"],"mappings":"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","sourcesContent":["function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport { useEffect, useState, useMemo } from 'react';\nimport useSize from '../useSize';\nexport default (function (list, options) {\n  var _useSize = useSize(),\n      _useSize2 = _slicedToArray(_useSize, 2),\n      size = _useSize2[0],\n      containerRef = _useSize2[1]; // 暂时禁止 cache\n  // const distanceCache = useRef<{ [key: number]: number }>({});\n\n\n  var _useState = useState({\n    start: 0,\n    end: 10\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var itemHeight = options.itemHeight,\n      _options$overscan = options.overscan,\n      overscan = _options$overscan === void 0 ? 5 : _options$overscan;\n\n  if (!itemHeight) {\n    console.warn('please enter a valid itemHeight');\n  }\n\n  var getViewCapacity = function getViewCapacity(containerHeight) {\n    if (typeof itemHeight === 'number') {\n      return Math.ceil(containerHeight / itemHeight);\n    }\n\n    var _state$start = state.start,\n        start = _state$start === void 0 ? 0 : _state$start;\n    var sum = 0;\n    var capacity = 0;\n\n    for (var i = start; i < list.length; i++) {\n      var height = itemHeight(i);\n      sum += height;\n\n      if (sum >= containerHeight) {\n        capacity = i;\n        break;\n      }\n    }\n\n    return capacity - start;\n  };\n\n  var getOffset = function getOffset(scrollTop) {\n    if (typeof itemHeight === 'number') {\n      return Math.floor(scrollTop / itemHeight) + 1;\n    }\n\n    var sum = 0;\n    var offset = 0;\n\n    for (var i = 0; i < list.length; i++) {\n      var height = itemHeight(i);\n      sum += height;\n\n      if (sum >= scrollTop) {\n        offset = i;\n        break;\n      }\n    }\n\n    return offset + 1;\n  };\n\n  var calculateRange = function calculateRange() {\n    var element = containerRef.current;\n\n    if (element) {\n      var offset = getOffset(element.scrollTop);\n      var viewCapacity = getViewCapacity(element.clientHeight);\n      var from = offset - overscan;\n      var to = offset + viewCapacity + overscan;\n      setState({\n        start: from < 0 ? 0 : from,\n        end: to > list.length ? list.length : to\n      });\n    }\n  };\n\n  useEffect(function () {\n    calculateRange();\n  }, [size.width, size.height]);\n  var totalHeight = useMemo(function () {\n    if (typeof itemHeight === 'number') {\n      return list.length * itemHeight;\n    }\n\n    return list.reduce(function (sum, _, index) {\n      return sum + itemHeight(index);\n    }, 0);\n  }, [list.length]);\n\n  var getDistanceTop = function getDistanceTop(index) {\n    // 如果有缓存，优先返回缓存值\n    // if (enableCache && distanceCache.current[index]) {\n    //   return distanceCache.current[index];\n    // }\n    if (typeof itemHeight === 'number') {\n      var _height = index * itemHeight; // if (enableCache) {\n      //   distanceCache.current[index] = height;\n      // }\n\n\n      return _height;\n    }\n\n    var height = list.slice(0, index).reduce(function (sum, _, i) {\n      return sum + itemHeight(i);\n    }, 0); // if (enableCache) {\n    //   distanceCache.current[index] = height;\n    // }\n\n    return height;\n  };\n\n  var scrollTo = function scrollTo(index) {\n    if (containerRef.current) {\n      containerRef.current.scrollTop = getDistanceTop(index);\n      calculateRange();\n    }\n  };\n\n  return {\n    list: list.slice(state.start, state.end).map(function (ele, index) {\n      return {\n        data: ele,\n        index: index + state.start\n      };\n    }),\n    scrollTo: scrollTo,\n    containerProps: {\n      ref: function ref(ele) {\n        containerRef.current = ele;\n      },\n      onScroll: function onScroll(e) {\n        e.preventDefault();\n        calculateRange();\n      },\n      style: {\n        overflowY: 'auto'\n      }\n    },\n    wrapperProps: {\n      style: {\n        width: '100%',\n        height: totalHeight,\n        paddingTop: getDistanceTop(state.start)\n      }\n    }\n  };\n});"]},"metadata":{},"sourceType":"module"}
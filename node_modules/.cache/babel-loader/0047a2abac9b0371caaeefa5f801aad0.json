{"ast":null,"code":"function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport { useRef, useCallback, useMemo, useEffect, useState } from 'react';\nimport useAsync from './useAsync';\nimport useUpdateEffect from './utils/useUpdateEffect';\n\nfunction useLoadMore(service, options) {\n  var _options$refreshDeps = options.refreshDeps,\n      refreshDeps = _options$refreshDeps === void 0 ? [] : _options$refreshDeps,\n      ref = options.ref,\n      isNoMore = options.isNoMore,\n      _options$threshold = options.threshold,\n      threshold = _options$threshold === void 0 ? 100 : _options$threshold,\n      fetchKey = options.fetchKey,\n      restOptions = _objectWithoutProperties(options, [\"refreshDeps\", \"ref\", \"isNoMore\", \"threshold\", \"fetchKey\"]);\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loadingMore = _useState2[0],\n      setLoadingMore = _useState2[1];\n\n  useEffect(function () {\n    if (options.fetchKey) {\n      console.warn(\"useRequest loadMore mode don't need fetchKey!\");\n    }\n  }, []);\n  var result = useAsync(service, _objectSpread({}, restOptions, {\n    fetchKey: function fetchKey(d) {\n      var _d$list;\n\n      return (d === null || d === void 0 ? void 0 : (_d$list = d.list) === null || _d$list === void 0 ? void 0 : _d$list.length) || 0;\n    },\n    onSuccess: function onSuccess() {\n      setLoadingMore(false);\n\n      if (options.onSuccess) {\n        options.onSuccess.apply(options, arguments);\n      }\n    }\n  }));\n  var data = result.data,\n      run = result.run,\n      params = result.params,\n      reset = result.reset,\n      loading = result.loading,\n      fetches = result.fetches;\n  var reload = useCallback(function () {\n    reset();\n\n    var _params = _toArray(params),\n        restParams = _params.slice(1);\n\n    run.apply(void 0, [undefined].concat(_toConsumableArray(restParams)));\n  }, [run, reset, params]);\n  var reloadRef = useRef(reload);\n  reloadRef.current = reload;\n  /* loadMore 场景下，如果 refreshDeps 变化，重置到第一页 */\n\n  useUpdateEffect(function () {\n    /* 只有自动执行的场景， refreshDeps 才有效 */\n    if (!options.manual) {\n      reloadRef.current();\n    }\n  }, _toConsumableArray(refreshDeps));\n  var dataGroup = useMemo(function () {\n    var listGroup = []; // 在 loadMore 时，不希望清空上一次的 data。需要把最后一个 非 loading 的请求 data，放回去。\n\n    var lastNoLoadingData = data;\n    Object.values(fetches).forEach(function (h) {\n      var _h$data;\n\n      if ((_h$data = h.data) === null || _h$data === void 0 ? void 0 : _h$data.list) {\n        var _h$data2;\n\n        listGroup = listGroup.concat((_h$data2 = h.data) === null || _h$data2 === void 0 ? void 0 : _h$data2.list);\n      }\n\n      if (!h.loading) {\n        lastNoLoadingData = h.data;\n      }\n    });\n    return _objectSpread({}, lastNoLoadingData, {\n      list: listGroup\n    });\n  }, [fetches, data]);\n  var noMore = isNoMore ? !loading && !loadingMore && isNoMore(dataGroup) : false;\n  var loadMore = useCallback(function () {\n    if (noMore) {\n      return;\n    }\n\n    setLoadingMore(true);\n\n    var _params2 = _toArray(params),\n        restParams = _params2.slice(1);\n\n    run.apply(void 0, [dataGroup].concat(_toConsumableArray(restParams)));\n  }, [noMore, run, dataGroup, params]);\n  /* 上拉加载的方法 */\n\n  var scrollMethod = useCallback(function () {\n    if (loading || !ref || !ref.current) {\n      return;\n    }\n\n    if (ref.current.scrollHeight - ref.current.scrollTop <= ref.current.clientHeight + threshold) {\n      loadMore();\n    }\n  }, [loading, ref, loadMore]);\n  /* 如果有 ref，则会上拉加载更多 */\n\n  useEffect(function () {\n    if (!ref || !ref.current) {\n      return function () {};\n    }\n\n    ref.current.addEventListener('scroll', scrollMethod);\n    return function () {\n      if (ref && ref.current) {\n        ref.current.removeEventListener('scroll', scrollMethod);\n      }\n    };\n  }, [scrollMethod]);\n  return _objectSpread({}, result, {\n    data: dataGroup,\n    reload: reload,\n    loading: loading && dataGroup.list.length === 0,\n    loadMore: loadMore,\n    loadingMore: loadingMore,\n    noMore: noMore\n  });\n}\n\nexport default useLoadMore;","map":{"version":3,"sources":["E:/github-project/cloudMusic-mobile/node_modules/@umijs/use-request/es/useLoadMore.js"],"names":["_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","Array","isArray","i","arr2","length","_toArray","_arrayWithHoles","_nonIterableRest","iter","Symbol","iterator","Object","prototype","toString","call","from","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","arguments","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","_slicedToArray","_iterableToArrayLimit","_arr","_n","_d","_e","undefined","_i","_s","next","done","err","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceSymbolKeys","indexOf","propertyIsEnumerable","sourceKeys","useRef","useCallback","useMemo","useEffect","useState","useAsync","useUpdateEffect","useLoadMore","service","options","_options$refreshDeps","refreshDeps","ref","isNoMore","_options$threshold","threshold","fetchKey","restOptions","_useState","_useState2","loadingMore","setLoadingMore","console","warn","result","d","_d$list","list","onSuccess","data","run","params","reset","loading","fetches","reload","_params","restParams","slice","concat","reloadRef","current","manual","dataGroup","listGroup","lastNoLoadingData","values","h","_h$data","_h$data2","noMore","loadMore","_params2","scrollMethod","scrollHeight","scrollTop","clientHeight","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest(); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { useRef, useCallback, useMemo, useEffect, useState } from 'react';\nimport useAsync from './useAsync';\nimport useUpdateEffect from './utils/useUpdateEffect';\n\nfunction useLoadMore(service, options) {\n  var _options$refreshDeps = options.refreshDeps,\n      refreshDeps = _options$refreshDeps === void 0 ? [] : _options$refreshDeps,\n      ref = options.ref,\n      isNoMore = options.isNoMore,\n      _options$threshold = options.threshold,\n      threshold = _options$threshold === void 0 ? 100 : _options$threshold,\n      fetchKey = options.fetchKey,\n      restOptions = _objectWithoutProperties(options, [\"refreshDeps\", \"ref\", \"isNoMore\", \"threshold\", \"fetchKey\"]);\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loadingMore = _useState2[0],\n      setLoadingMore = _useState2[1];\n\n  useEffect(function () {\n    if (options.fetchKey) {\n      console.warn(\"useRequest loadMore mode don't need fetchKey!\");\n    }\n  }, []);\n  var result = useAsync(service, _objectSpread({}, restOptions, {\n    fetchKey: function fetchKey(d) {\n      var _d$list;\n\n      return (d === null || d === void 0 ? void 0 : (_d$list = d.list) === null || _d$list === void 0 ? void 0 : _d$list.length) || 0;\n    },\n    onSuccess: function onSuccess() {\n      setLoadingMore(false);\n\n      if (options.onSuccess) {\n        options.onSuccess.apply(options, arguments);\n      }\n    }\n  }));\n  var data = result.data,\n      run = result.run,\n      params = result.params,\n      reset = result.reset,\n      loading = result.loading,\n      fetches = result.fetches;\n  var reload = useCallback(function () {\n    reset();\n\n    var _params = _toArray(params),\n        restParams = _params.slice(1);\n\n    run.apply(void 0, [undefined].concat(_toConsumableArray(restParams)));\n  }, [run, reset, params]);\n  var reloadRef = useRef(reload);\n  reloadRef.current = reload;\n  /* loadMore 场景下，如果 refreshDeps 变化，重置到第一页 */\n\n  useUpdateEffect(function () {\n    /* 只有自动执行的场景， refreshDeps 才有效 */\n    if (!options.manual) {\n      reloadRef.current();\n    }\n  }, _toConsumableArray(refreshDeps));\n  var dataGroup = useMemo(function () {\n    var listGroup = []; // 在 loadMore 时，不希望清空上一次的 data。需要把最后一个 非 loading 的请求 data，放回去。\n\n    var lastNoLoadingData = data;\n    Object.values(fetches).forEach(function (h) {\n      var _h$data;\n\n      if ((_h$data = h.data) === null || _h$data === void 0 ? void 0 : _h$data.list) {\n        var _h$data2;\n\n        listGroup = listGroup.concat((_h$data2 = h.data) === null || _h$data2 === void 0 ? void 0 : _h$data2.list);\n      }\n\n      if (!h.loading) {\n        lastNoLoadingData = h.data;\n      }\n    });\n    return _objectSpread({}, lastNoLoadingData, {\n      list: listGroup\n    });\n  }, [fetches, data]);\n  var noMore = isNoMore ? !loading && !loadingMore && isNoMore(dataGroup) : false;\n  var loadMore = useCallback(function () {\n    if (noMore) {\n      return;\n    }\n\n    setLoadingMore(true);\n\n    var _params2 = _toArray(params),\n        restParams = _params2.slice(1);\n\n    run.apply(void 0, [dataGroup].concat(_toConsumableArray(restParams)));\n  }, [noMore, run, dataGroup, params]);\n  /* 上拉加载的方法 */\n\n  var scrollMethod = useCallback(function () {\n    if (loading || !ref || !ref.current) {\n      return;\n    }\n\n    if (ref.current.scrollHeight - ref.current.scrollTop <= ref.current.clientHeight + threshold) {\n      loadMore();\n    }\n  }, [loading, ref, loadMore]);\n  /* 如果有 ref，则会上拉加载更多 */\n\n  useEffect(function () {\n    if (!ref || !ref.current) {\n      return function () {};\n    }\n\n    ref.current.addEventListener('scroll', scrollMethod);\n    return function () {\n      if (ref && ref.current) {\n        ref.current.removeEventListener('scroll', scrollMethod);\n      }\n    };\n  }, [scrollMethod]);\n  return _objectSpread({}, result, {\n    data: dataGroup,\n    reload: reload,\n    loading: loading && dataGroup.list.length === 0,\n    loadMore: loadMore,\n    loadingMore: loadingMore,\n    noMore: noMore\n  });\n}\n\nexport default useLoadMore;"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport useAsync from './useAsync';\nimport useUpdateEffect from './utils/useUpdateEffect';\n\nfunction usePaginated(service, options) {\n  var paginated = options.paginated,\n      _options$defaultPageS = options.defaultPageSize,\n      defaultPageSize = _options$defaultPageS === void 0 ? 10 : _options$defaultPageS,\n      _options$refreshDeps = options.refreshDeps,\n      refreshDeps = _options$refreshDeps === void 0 ? [] : _options$refreshDeps,\n      fetchKey = options.fetchKey,\n      restOptions = _objectWithoutProperties(options, [\"paginated\", \"defaultPageSize\", \"refreshDeps\", \"fetchKey\"]);\n\n  useEffect(function () {\n    if (fetchKey) {\n      console.error('useRequest pagination\\'s fetchKey will not work!');\n    }\n  }, []);\n\n  var _useAsync = useAsync(service, _objectSpread({\n    defaultParams: [{\n      current: 1,\n      pageSize: defaultPageSize\n    }]\n  }, restOptions)),\n      data = _useAsync.data,\n      params = _useAsync.params,\n      run = _useAsync.run,\n      loading = _useAsync.loading,\n      rest = _objectWithoutProperties(_useAsync, [\"data\", \"params\", \"run\", \"loading\"]);\n\n  var _ref = params && params[0] ? params[0] : {},\n      _ref$current = _ref.current,\n      current = _ref$current === void 0 ? 1 : _ref$current,\n      _ref$pageSize = _ref.pageSize,\n      pageSize = _ref$pageSize === void 0 ? defaultPageSize : _ref$pageSize,\n      _ref$sorter = _ref.sorter,\n      sorter = _ref$sorter === void 0 ? {} : _ref$sorter,\n      _ref$filters = _ref.filters,\n      filters = _ref$filters === void 0 ? {} : _ref$filters; // 只改变 pagination，其他参数原样传递\n\n\n  var runChangePaination = useCallback(function (paginationParams) {\n    var _params = _toArray(params),\n        oldPaginationParams = _params[0],\n        restParams = _params.slice(1);\n\n    run.apply(void 0, [_objectSpread({}, oldPaginationParams, {}, paginationParams)].concat(_toConsumableArray(restParams)));\n  }, [run, params]);\n  var total = (data === null || data === void 0 ? void 0 : data.total) || 0;\n  var totalPage = useMemo(function () {\n    return Math.ceil(total / pageSize);\n  }, [pageSize, total]);\n  var onChange = useCallback(function (c, p) {\n    var toCurrent = c <= 0 ? 1 : c;\n    var toPageSize = p <= 0 ? 1 : p;\n    var tempTotalPage = Math.ceil(total / toPageSize);\n\n    if (toCurrent > tempTotalPage) {\n      toCurrent = tempTotalPage;\n    }\n\n    runChangePaination({\n      current: c,\n      pageSize: p\n    });\n  }, [total, runChangePaination]);\n  var changeCurrent = useCallback(function (c) {\n    onChange(c, pageSize);\n  }, [onChange, pageSize]);\n  var changePageSize = useCallback(function (p) {\n    onChange(current, p);\n  }, [onChange, current]);\n  var changeCurrentRef = useRef(changeCurrent);\n  changeCurrentRef.current = changeCurrent;\n  /* 分页场景下，如果 refreshDeps 变化，重置分页 */\n\n  useUpdateEffect(function () {\n    /* 只有自动执行的场景， refreshDeps 才有效 */\n    if (!options.manual) {\n      changeCurrentRef.current(1);\n    }\n  }, _toConsumableArray(refreshDeps)); // 表格翻页 排序 筛选等\n\n  var changeTable = useCallback(function (p, f, s) {\n    runChangePaination({\n      current: p.current,\n      pageSize: p.pageSize || defaultPageSize,\n      filters: f,\n      sorter: s\n    });\n  }, [filters, sorter, runChangePaination]);\n  return _objectSpread({\n    loading: loading,\n    data: data,\n    params: params,\n    run: run,\n    pagination: {\n      current: current,\n      pageSize: pageSize,\n      total: total,\n      totalPage: totalPage,\n      onChange: onChange,\n      changeCurrent: changeCurrent,\n      changePageSize: changePageSize\n    },\n    tableProps: {\n      dataSource: (data === null || data === void 0 ? void 0 : data.list) || [],\n      loading: loading,\n      onChange: changeTable,\n      pagination: {\n        current: current,\n        pageSize: pageSize,\n        total: total\n      }\n    },\n    sorter: sorter,\n    filters: filters\n  }, rest);\n}\n\nexport default usePaginated;","map":{"version":3,"sources":["E:/github-project/cloudMusic-mobile/node_modules/@umijs/use-request/es/usePaginated.js"],"names":["_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","Array","isArray","i","arr2","length","_toArray","_arrayWithHoles","_nonIterableRest","iter","Symbol","iterator","Object","prototype","toString","call","from","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","arguments","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceSymbolKeys","indexOf","propertyIsEnumerable","sourceKeys","useCallback","useEffect","useMemo","useRef","useAsync","useUpdateEffect","usePaginated","service","options","paginated","_options$defaultPageS","defaultPageSize","_options$refreshDeps","refreshDeps","fetchKey","restOptions","console","error","_useAsync","defaultParams","current","pageSize","data","params","run","loading","rest","_ref","_ref$current","_ref$pageSize","_ref$sorter","sorter","_ref$filters","filters","runChangePaination","paginationParams","_params","oldPaginationParams","restParams","slice","concat","total","totalPage","Math","ceil","onChange","c","p","toCurrent","toPageSize","tempTotalPage","changeCurrent","changePageSize","changeCurrentRef","manual","changeTable","f","s","pagination","tableProps","dataSource","list"],"mappings":"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","sourcesContent":["function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport useAsync from './useAsync';\nimport useUpdateEffect from './utils/useUpdateEffect';\n\nfunction usePaginated(service, options) {\n  var paginated = options.paginated,\n      _options$defaultPageS = options.defaultPageSize,\n      defaultPageSize = _options$defaultPageS === void 0 ? 10 : _options$defaultPageS,\n      _options$refreshDeps = options.refreshDeps,\n      refreshDeps = _options$refreshDeps === void 0 ? [] : _options$refreshDeps,\n      fetchKey = options.fetchKey,\n      restOptions = _objectWithoutProperties(options, [\"paginated\", \"defaultPageSize\", \"refreshDeps\", \"fetchKey\"]);\n\n  useEffect(function () {\n    if (fetchKey) {\n      console.error('useRequest pagination\\'s fetchKey will not work!');\n    }\n  }, []);\n\n  var _useAsync = useAsync(service, _objectSpread({\n    defaultParams: [{\n      current: 1,\n      pageSize: defaultPageSize\n    }]\n  }, restOptions)),\n      data = _useAsync.data,\n      params = _useAsync.params,\n      run = _useAsync.run,\n      loading = _useAsync.loading,\n      rest = _objectWithoutProperties(_useAsync, [\"data\", \"params\", \"run\", \"loading\"]);\n\n  var _ref = params && params[0] ? params[0] : {},\n      _ref$current = _ref.current,\n      current = _ref$current === void 0 ? 1 : _ref$current,\n      _ref$pageSize = _ref.pageSize,\n      pageSize = _ref$pageSize === void 0 ? defaultPageSize : _ref$pageSize,\n      _ref$sorter = _ref.sorter,\n      sorter = _ref$sorter === void 0 ? {} : _ref$sorter,\n      _ref$filters = _ref.filters,\n      filters = _ref$filters === void 0 ? {} : _ref$filters; // 只改变 pagination，其他参数原样传递\n\n\n  var runChangePaination = useCallback(function (paginationParams) {\n    var _params = _toArray(params),\n        oldPaginationParams = _params[0],\n        restParams = _params.slice(1);\n\n    run.apply(void 0, [_objectSpread({}, oldPaginationParams, {}, paginationParams)].concat(_toConsumableArray(restParams)));\n  }, [run, params]);\n  var total = (data === null || data === void 0 ? void 0 : data.total) || 0;\n  var totalPage = useMemo(function () {\n    return Math.ceil(total / pageSize);\n  }, [pageSize, total]);\n  var onChange = useCallback(function (c, p) {\n    var toCurrent = c <= 0 ? 1 : c;\n    var toPageSize = p <= 0 ? 1 : p;\n    var tempTotalPage = Math.ceil(total / toPageSize);\n\n    if (toCurrent > tempTotalPage) {\n      toCurrent = tempTotalPage;\n    }\n\n    runChangePaination({\n      current: c,\n      pageSize: p\n    });\n  }, [total, runChangePaination]);\n  var changeCurrent = useCallback(function (c) {\n    onChange(c, pageSize);\n  }, [onChange, pageSize]);\n  var changePageSize = useCallback(function (p) {\n    onChange(current, p);\n  }, [onChange, current]);\n  var changeCurrentRef = useRef(changeCurrent);\n  changeCurrentRef.current = changeCurrent;\n  /* 分页场景下，如果 refreshDeps 变化，重置分页 */\n\n  useUpdateEffect(function () {\n    /* 只有自动执行的场景， refreshDeps 才有效 */\n    if (!options.manual) {\n      changeCurrentRef.current(1);\n    }\n  }, _toConsumableArray(refreshDeps)); // 表格翻页 排序 筛选等\n\n  var changeTable = useCallback(function (p, f, s) {\n    runChangePaination({\n      current: p.current,\n      pageSize: p.pageSize || defaultPageSize,\n      filters: f,\n      sorter: s\n    });\n  }, [filters, sorter, runChangePaination]);\n  return _objectSpread({\n    loading: loading,\n    data: data,\n    params: params,\n    run: run,\n    pagination: {\n      current: current,\n      pageSize: pageSize,\n      total: total,\n      totalPage: totalPage,\n      onChange: onChange,\n      changeCurrent: changeCurrent,\n      changePageSize: changePageSize\n    },\n    tableProps: {\n      dataSource: (data === null || data === void 0 ? void 0 : data.list) || [],\n      loading: loading,\n      onChange: changeTable,\n      pagination: {\n        current: current,\n        pageSize: pageSize,\n        total: total\n      }\n    },\n    sorter: sorter,\n    filters: filters\n  }, rest);\n}\n\nexport default usePaginated;"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"function _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nimport { useCallback, useEffect, useReducer, useRef, useMemo } from 'react';\nimport isEqual from 'lodash.isequal';\nimport useAsync from '../useAsync';\nimport useUpdateEffect from '../useUpdateEffect';\n\nvar UseTableInitState = function UseTableInitState() {\n  _classCallCheck(this, UseTableInitState);\n\n  this.searchType = 'simple';\n  this.current = 1;\n  this.pageSize = 10;\n  this.total = 0;\n  this.formData = {};\n  this.activeFormData = {};\n  this.count = 0;\n  this.data = [];\n  this.filters = {};\n  this.sorter = {};\n}; // 缓存\n\n\nvar cacheData = {};\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'updateState':\n      return _objectSpread({}, state, {}, action.payload);\n\n    default:\n      throw new Error();\n  }\n};\n\nfunction useAntdTable(fn, deps, options) {\n  var _deps = Array.isArray(deps) ? deps : [];\n\n  var _options = _typeof(deps) === 'object' && !Array.isArray(deps) ? deps : options || {};\n\n  var initState = useMemo(function () {\n    return new UseTableInitState();\n  }, []);\n  var _options$defaultPageS = _options.defaultPageSize,\n      defaultPageSize = _options$defaultPageS === void 0 ? 10 : _options$defaultPageS,\n      id = _options.id,\n      form = _options.form,\n      formatResult = _options.formatResult;\n\n  var _useReducer = useReducer(reducer, _objectSpread({}, initState, {\n    pageSize: defaultPageSize\n  })),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n  /* 临时记录切换前的表单数据 */\n\n\n  var tempFieldsValueRef = useRef({});\n  var stateRef = useRef({});\n  stateRef.current = state;\n\n  var _useAsync = useAsync(fn, _deps, {\n    manual: true\n  }),\n      run = _useAsync.run,\n      loading = _useAsync.loading;\n\n  var reload = useCallback(function () {\n    dispatch({\n      type: 'updateState',\n      payload: {\n        current: 1,\n        count: state.count + 1\n      }\n    });\n  }, [state.count]);\n  var refresh = useCallback(function () {\n    dispatch({\n      type: 'updateState',\n      payload: {\n        count: state.count + 1\n      }\n    });\n  }, [state.count]);\n  /* 初始化执行 */\n\n  useEffect(function () {\n    /* 有缓存，恢复 */\n    if (id && cacheData[id]) {\n      var cache = cacheData[id];\n      /* 修改完 formData 和 searchType 之后，会触发 useUpdateEffect，给当前表单赋值 */\n\n      dispatch({\n        type: 'updateState',\n        payload: {\n          current: cache.current,\n          pageSize: cache.pageSize,\n          searchType: cache.searchType,\n          activeFormData: cache.activeFormData,\n          formData: cache.formData,\n          filters: cache.filters,\n          sorter: cache.sorter,\n          count: state.count + 1\n        }\n      });\n    } else if (form) {\n      /* 如果有 form，需要走 searchSubmit，为了初始化的时候，拿到 initialValue */\n      searchSubmit();\n    } else {\n      refresh();\n    }\n\n    if (id) {\n      return function () {\n        cacheData[id] = stateRef.current;\n      };\n    }\n\n    return function () {};\n  }, []);\n  /* deps 变化后，重置表格 */\n\n  useUpdateEffect(function () {\n    reload();\n  }, _deps);\n  /* state.count 变化时，重新请求数据 */\n\n  useUpdateEffect(function () {\n    var formattedData = {};\n    /* 把  undefined 的过滤掉 */\n\n    Object.keys(state.activeFormData).forEach(function (key) {\n      if (state.activeFormData[key] !== undefined) {\n        formattedData[key] = state.activeFormData[key];\n      }\n    });\n\n    var params = _objectSpread({\n      current: state.current,\n      pageSize: state.pageSize\n    }, formattedData);\n\n    if (state.filters) {\n      params.filters = state.filters;\n    }\n\n    if (state.sorter) {\n      params.sorter = state.sorter;\n    }\n\n    run(params).then(function (res) {\n      var payload = formatResult ? formatResult(res) : res;\n      dispatch({\n        type: 'updateState',\n        payload: payload\n      });\n    });\n  }, [state.current, state.pageSize, state.count]);\n  /* 改变了 searchType，或者 formData，恢复表单数据 */\n\n  useUpdateEffect(function () {\n    if (!form) {\n      return;\n    }\n\n    var targetFormData = _objectSpread({}, state.formData, {}, tempFieldsValueRef.current);\n\n    var existFormData = {};\n    Object.keys(targetFormData).forEach(function (key) {\n      if (form.getFieldInstance ? form.getFieldInstance(key) : true) {\n        existFormData[key] = targetFormData[key];\n      }\n    });\n\n    if (form.setFieldsValue) {\n      form.setFieldsValue(existFormData);\n    }\n\n    tempFieldsValueRef.current = {};\n  }, [state.searchType, state.formData]);\n  /* 获得当前 form 数据 */\n\n  var getCurrentFieldsValues = useCallback(function () {\n    if (!form) {\n      return [];\n    }\n\n    var fieldsValue = {};\n\n    if (form.getFieldsValue) {\n      fieldsValue = form.getFieldsValue();\n    }\n\n    var filterFiledsValue = {};\n    Object.keys(fieldsValue).forEach(function (key) {\n      if (form.getFieldInstance ? form.getFieldInstance(key) : true) {\n        filterFiledsValue[key] = fieldsValue[key];\n      }\n    });\n    return filterFiledsValue;\n  }, [form]); // 表单搜索\n\n  var searchSubmit = useCallback(function (e) {\n    if (!form) {\n      return;\n    }\n\n    if (e && e.preventDefault) {\n      e.preventDefault();\n    }\n\n    setTimeout(function () {\n      var activeFormData = getCurrentFieldsValues();\n      dispatch({\n        type: 'updateState',\n        payload: {\n          activeFormData: activeFormData,\n          formData: _objectSpread({}, state.formData, {}, activeFormData)\n        }\n      });\n      reload();\n    });\n  }, [form, reload]); // 重置表单\n\n  var searchReset = useCallback(function () {\n    if (!form) {\n      return;\n    } // 恢复初始值\n\n\n    if (form.resetFields) {\n      form.resetFields();\n    } // 重置表单后，拿到当前默认值\n\n\n    var activeFormData = getCurrentFieldsValues();\n    dispatch({\n      type: 'updateState',\n      payload: {\n        activeFormData: activeFormData,\n        formData: activeFormData\n      }\n    });\n    reload();\n  }, [form, reload]); // 切换搜索类型\n\n  var changeSearchType = useCallback(function () {\n    if (!form) {\n      return;\n    }\n\n    tempFieldsValueRef.current = getCurrentFieldsValues();\n    var targetSearchType = state.searchType === 'simple' ? 'advance' : 'simple';\n    dispatch({\n      type: 'updateState',\n      payload: {\n        searchType: targetSearchType\n      }\n    });\n  }, [state.searchType]); // 表格翻页 排序 筛选等\n\n  var changeTable = useCallback(function (p) {\n    var f = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var s = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {}; // antd table 的初始状态 filter 带有 null 字段，需要先去除后再比较\n\n    var realFilter = _objectSpread({}, f);\n\n    Object.entries(realFilter).forEach(function (item) {\n      if (item[1] === null) {\n        delete realFilter[item[0]];\n      }\n    });\n    var needReload = !isEqual(realFilter, state.filters) || s.field !== state.sorter.field || s.order !== state.sorter.order;\n    dispatch({\n      type: 'updateState',\n      payload: {\n        current: needReload ? 1 : p.current,\n        pageSize: p.pageSize,\n        count: state.count + 1,\n        filters: f,\n        sorter: s\n      }\n    });\n  }, [state.count]);\n  var result = {\n    /* table 已经废弃 */\n    table: {\n      dataSource: state.data,\n      loading: loading,\n      onChange: changeTable,\n      pagination: {\n        current: state.current,\n        pageSize: state.pageSize,\n        total: state.total\n      }\n    },\n    tableProps: {\n      dataSource: state.data,\n      loading: loading,\n      onChange: changeTable,\n      pagination: {\n        current: state.current,\n        pageSize: state.pageSize,\n        total: state.total\n      }\n    },\n    sorter: state.sorter,\n    filters: state.filters,\n    refresh: refresh\n  };\n\n  if (form) {\n    result.search = {\n      submit: searchSubmit,\n      type: state.searchType,\n      changeType: changeSearchType,\n      reset: searchReset\n    };\n  }\n\n  return result;\n}\n\nexport default useAntdTable;","map":{"version":3,"sources":["E:/github-project/cloudMusic-mobile/node_modules/@umijs/hooks/es/useAntdTable/index.js"],"names":["_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","TypeError","Symbol","iterator","Object","prototype","toString","call","_arr","_n","_d","_e","undefined","_i","_s","next","done","push","value","length","err","Array","isArray","_typeof","obj","constructor","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","apply","_objectSpread","target","arguments","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","configurable","writable","_classCallCheck","instance","Constructor","useCallback","useEffect","useReducer","useRef","useMemo","isEqual","useAsync","useUpdateEffect","UseTableInitState","searchType","current","pageSize","total","formData","activeFormData","count","data","filters","sorter","cacheData","reducer","state","action","type","payload","Error","useAntdTable","fn","deps","options","_deps","_options","initState","_options$defaultPageS","defaultPageSize","id","form","formatResult","_useReducer","_useReducer2","dispatch","tempFieldsValueRef","stateRef","_useAsync","manual","run","loading","reload","refresh","cache","searchSubmit","formattedData","params","then","res","targetFormData","existFormData","getFieldInstance","setFieldsValue","getCurrentFieldsValues","fieldsValue","getFieldsValue","filterFiledsValue","e","preventDefault","setTimeout","searchReset","resetFields","changeSearchType","targetSearchType","changeTable","p","f","s","realFilter","entries","item","needReload","field","order","result","table","dataSource","onChange","pagination","tableProps","search","submit","changeType","reset"],"mappings":"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","sourcesContent":["function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nimport { useCallback, useEffect, useReducer, useRef, useMemo } from 'react';\nimport isEqual from 'lodash.isequal';\nimport useAsync from '../useAsync';\nimport useUpdateEffect from '../useUpdateEffect';\n\nvar UseTableInitState = function UseTableInitState() {\n  _classCallCheck(this, UseTableInitState);\n\n  this.searchType = 'simple';\n  this.current = 1;\n  this.pageSize = 10;\n  this.total = 0;\n  this.formData = {};\n  this.activeFormData = {};\n  this.count = 0;\n  this.data = [];\n  this.filters = {};\n  this.sorter = {};\n}; // 缓存\n\n\nvar cacheData = {};\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'updateState':\n      return _objectSpread({}, state, {}, action.payload);\n\n    default:\n      throw new Error();\n  }\n};\n\nfunction useAntdTable(fn, deps, options) {\n  var _deps = Array.isArray(deps) ? deps : [];\n\n  var _options = _typeof(deps) === 'object' && !Array.isArray(deps) ? deps : options || {};\n\n  var initState = useMemo(function () {\n    return new UseTableInitState();\n  }, []);\n  var _options$defaultPageS = _options.defaultPageSize,\n      defaultPageSize = _options$defaultPageS === void 0 ? 10 : _options$defaultPageS,\n      id = _options.id,\n      form = _options.form,\n      formatResult = _options.formatResult;\n\n  var _useReducer = useReducer(reducer, _objectSpread({}, initState, {\n    pageSize: defaultPageSize\n  })),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n  /* 临时记录切换前的表单数据 */\n\n\n  var tempFieldsValueRef = useRef({});\n  var stateRef = useRef({});\n  stateRef.current = state;\n\n  var _useAsync = useAsync(fn, _deps, {\n    manual: true\n  }),\n      run = _useAsync.run,\n      loading = _useAsync.loading;\n\n  var reload = useCallback(function () {\n    dispatch({\n      type: 'updateState',\n      payload: {\n        current: 1,\n        count: state.count + 1\n      }\n    });\n  }, [state.count]);\n  var refresh = useCallback(function () {\n    dispatch({\n      type: 'updateState',\n      payload: {\n        count: state.count + 1\n      }\n    });\n  }, [state.count]);\n  /* 初始化执行 */\n\n  useEffect(function () {\n    /* 有缓存，恢复 */\n    if (id && cacheData[id]) {\n      var cache = cacheData[id];\n      /* 修改完 formData 和 searchType 之后，会触发 useUpdateEffect，给当前表单赋值 */\n\n      dispatch({\n        type: 'updateState',\n        payload: {\n          current: cache.current,\n          pageSize: cache.pageSize,\n          searchType: cache.searchType,\n          activeFormData: cache.activeFormData,\n          formData: cache.formData,\n          filters: cache.filters,\n          sorter: cache.sorter,\n          count: state.count + 1\n        }\n      });\n    } else if (form) {\n      /* 如果有 form，需要走 searchSubmit，为了初始化的时候，拿到 initialValue */\n      searchSubmit();\n    } else {\n      refresh();\n    }\n\n    if (id) {\n      return function () {\n        cacheData[id] = stateRef.current;\n      };\n    }\n\n    return function () {};\n  }, []);\n  /* deps 变化后，重置表格 */\n\n  useUpdateEffect(function () {\n    reload();\n  }, _deps);\n  /* state.count 变化时，重新请求数据 */\n\n  useUpdateEffect(function () {\n    var formattedData = {};\n    /* 把  undefined 的过滤掉 */\n\n    Object.keys(state.activeFormData).forEach(function (key) {\n      if (state.activeFormData[key] !== undefined) {\n        formattedData[key] = state.activeFormData[key];\n      }\n    });\n\n    var params = _objectSpread({\n      current: state.current,\n      pageSize: state.pageSize\n    }, formattedData);\n\n    if (state.filters) {\n      params.filters = state.filters;\n    }\n\n    if (state.sorter) {\n      params.sorter = state.sorter;\n    }\n\n    run(params).then(function (res) {\n      var payload = formatResult ? formatResult(res) : res;\n      dispatch({\n        type: 'updateState',\n        payload: payload\n      });\n    });\n  }, [state.current, state.pageSize, state.count]);\n  /* 改变了 searchType，或者 formData，恢复表单数据 */\n\n  useUpdateEffect(function () {\n    if (!form) {\n      return;\n    }\n\n    var targetFormData = _objectSpread({}, state.formData, {}, tempFieldsValueRef.current);\n\n    var existFormData = {};\n    Object.keys(targetFormData).forEach(function (key) {\n      if (form.getFieldInstance ? form.getFieldInstance(key) : true) {\n        existFormData[key] = targetFormData[key];\n      }\n    });\n\n    if (form.setFieldsValue) {\n      form.setFieldsValue(existFormData);\n    }\n\n    tempFieldsValueRef.current = {};\n  }, [state.searchType, state.formData]);\n  /* 获得当前 form 数据 */\n\n  var getCurrentFieldsValues = useCallback(function () {\n    if (!form) {\n      return [];\n    }\n\n    var fieldsValue = {};\n\n    if (form.getFieldsValue) {\n      fieldsValue = form.getFieldsValue();\n    }\n\n    var filterFiledsValue = {};\n    Object.keys(fieldsValue).forEach(function (key) {\n      if (form.getFieldInstance ? form.getFieldInstance(key) : true) {\n        filterFiledsValue[key] = fieldsValue[key];\n      }\n    });\n    return filterFiledsValue;\n  }, [form]); // 表单搜索\n\n  var searchSubmit = useCallback(function (e) {\n    if (!form) {\n      return;\n    }\n\n    if (e && e.preventDefault) {\n      e.preventDefault();\n    }\n\n    setTimeout(function () {\n      var activeFormData = getCurrentFieldsValues();\n      dispatch({\n        type: 'updateState',\n        payload: {\n          activeFormData: activeFormData,\n          formData: _objectSpread({}, state.formData, {}, activeFormData)\n        }\n      });\n      reload();\n    });\n  }, [form, reload]); // 重置表单\n\n  var searchReset = useCallback(function () {\n    if (!form) {\n      return;\n    } // 恢复初始值\n\n\n    if (form.resetFields) {\n      form.resetFields();\n    } // 重置表单后，拿到当前默认值\n\n\n    var activeFormData = getCurrentFieldsValues();\n    dispatch({\n      type: 'updateState',\n      payload: {\n        activeFormData: activeFormData,\n        formData: activeFormData\n      }\n    });\n    reload();\n  }, [form, reload]); // 切换搜索类型\n\n  var changeSearchType = useCallback(function () {\n    if (!form) {\n      return;\n    }\n\n    tempFieldsValueRef.current = getCurrentFieldsValues();\n    var targetSearchType = state.searchType === 'simple' ? 'advance' : 'simple';\n    dispatch({\n      type: 'updateState',\n      payload: {\n        searchType: targetSearchType\n      }\n    });\n  }, [state.searchType]); // 表格翻页 排序 筛选等\n\n  var changeTable = useCallback(function (p) {\n    var f = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var s = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    // antd table 的初始状态 filter 带有 null 字段，需要先去除后再比较\n    var realFilter = _objectSpread({}, f);\n\n    Object.entries(realFilter).forEach(function (item) {\n      if (item[1] === null) {\n        delete realFilter[item[0]];\n      }\n    });\n    var needReload = !isEqual(realFilter, state.filters) || s.field !== state.sorter.field || s.order !== state.sorter.order;\n    dispatch({\n      type: 'updateState',\n      payload: {\n        current: needReload ? 1 : p.current,\n        pageSize: p.pageSize,\n        count: state.count + 1,\n        filters: f,\n        sorter: s\n      }\n    });\n  }, [state.count]);\n  var result = {\n    /* table 已经废弃 */\n    table: {\n      dataSource: state.data,\n      loading: loading,\n      onChange: changeTable,\n      pagination: {\n        current: state.current,\n        pageSize: state.pageSize,\n        total: state.total\n      }\n    },\n    tableProps: {\n      dataSource: state.data,\n      loading: loading,\n      onChange: changeTable,\n      pagination: {\n        current: state.current,\n        pageSize: state.pageSize,\n        total: state.total\n      }\n    },\n    sorter: state.sorter,\n    filters: state.filters,\n    refresh: refresh\n  };\n\n  if (form) {\n    result.search = {\n      submit: searchSubmit,\n      type: state.searchType,\n      changeType: changeSearchType,\n      reset: searchReset\n    };\n  }\n\n  return result;\n}\n\nexport default useAntdTable;"]},"metadata":{},"sourceType":"module"}